<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="MySQL知识汇总, 小小千千 Blog">
    <meta name="description" content="心怀梦想 不惧前行">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>MySQL知识汇总 | 小小千千 Blog</title>
    <link rel="icon" type="image/png" href="/medias/logo-jiagou.png">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">

    <script src="/libs/jquery/jquery.min.js"></script>

<meta name="generator" content="Hexo 5.4.1"></head>




<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo-jiagou.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">小小千千 Blog</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/contact" class="waves-effect waves-light">
      
      <i class="fas fa-comments" style="zoom: 0.6;"></i>
      
      <span>留言板</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo-jiagou.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">小小千千 Blog</div>
        <div class="logo-desc">
            
            心怀梦想 不惧前行
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/contact" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-comments"></i>
			
			留言板
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/Jason-QianHao" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>


        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/Jason-QianHao" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    



<div class="bg-cover pd-header post-cover" style="background-image: url('http://jason-qianhao.xyz/banner/41.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">MySQL知识汇总</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        width: 345px;
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        padding: 35px 0 15px 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content {
        padding-bottom: 30px;
        overflow: auto;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;

        position: absolute;
        right: 23.5vw;
        display: block;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 15px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/">
                                <span class="chip bg-color">数据库</span>
                            </a>
                        
                            <a href="/tags/MySQL/">
                                <span class="chip bg-color">MySQL</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/" class="post-category">
                                数据库
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2020-10-30
                </div>
                

                

                
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>文章字数:&nbsp;&nbsp;
                    10.6k
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-clock fa-fw"></i>阅读时长:&nbsp;&nbsp;
                    38 分
                </div>
                

                
                    <div id="busuanzi_container_page_pv" class="info-break-policy">
                        <i class="far fa-eye fa-fw"></i>阅读次数:&nbsp;&nbsp;
                        <span id="busuanzi_value_page_pv"></span>
                    </div>
				
            </div>
        </div>
        <hr class="clearfix">

        
        <!-- 是否加载使用自带的 prismjs. -->
        <link rel="stylesheet" href="/libs/prism/prism.css">
        

        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <h1 id="MySQL知识汇总"><a href="#MySQL知识汇总" class="headerlink" title="MySQL知识汇总"></a>MySQL知识汇总</h1><blockquote>
<p>目录</p>
<ol>
<li>数据库的概念</li>
<li>MySql逻辑架构</li>
<li>并发控制</li>
<li>事务</li>
<li>MVCC多版本并发控制 </li>
<li>存储引擎</li>
<li>索引</li>
<li>MySql优化</li>
<li>其他知识点  </li>
</ol>
<p>参考资料  </p>
<ul>
<li>《高性能MySql》  </li>
<li>《尚硅谷MySql》  </li>
<li>JavaG  </li>
<li><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/ImB0O-Z8IXldvt6YQk80jg">https://mp.weixin.qq.com/s/ImB0O-Z8IXldvt6YQk80jg</a></li>
<li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/tufujie/p/9413852.html">https://www.cnblogs.com/tufujie/p/9413852.html</a></li>
<li><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/Wjzsws5t9HtOIbAA7gHbMg">https://mp.weixin.qq.com/s/Wjzsws5t9HtOIbAA7gHbMg</a></li>
</ul>
</blockquote>
<h1 id="数据库的概念"><a href="#数据库的概念" class="headerlink" title="数据库的概念"></a>数据库的概念</h1><p>（1）DB</p>
<p>数据库（database）：存储数据的“仓库”。它保存了一系列有组织的数据。</p>
<p>（2）DBMS</p>
<p>数据库管理系统（Database Management System）。数据库是通过DBMS创建和操作的容器</p>
<p>（3）SQL</p>
<p>结构化查询语言（Structure Query Language）：专门用来与数据库通信的语言</p>
<h1 id="MySql逻辑架构"><a href="#MySql逻辑架构" class="headerlink" title="MySql逻辑架构"></a>MySql逻辑架构</h1><h2 id="架构图"><a href="#架构图" class="headerlink" title="架构图"></a>架构图</h2><img src="http://jason-qianhao.xyz/1240-20210630204745542.jpeg" style="zoom: 50%;" />

<h2 id="连接-线程管理"><a href="#连接-线程管理" class="headerlink" title="连接/线程管理"></a>连接/线程管理</h2><p>（1）每个客户端连接都会在服务器进程中拥有一个线程</p>
<p>（2）数据库连接池</p>
<ul>
<li>池化思想：预设资源</li>
<li>本质是socket连接</li>
<li>作用：维护连接的缓存，以便将来重用连接</li>
</ul>
<p>（3）默认端口号：<strong>3306</strong></p>
<h2 id="关系型数据库"><a href="#关系型数据库" class="headerlink" title="关系型数据库"></a>关系型数据库</h2><p>（1）关系型数据库<br>  关系型数据库是建立在关系模型基础上的数据库，借助于集合代数等数学概念和方法来处理数据库中的数据。简单说，<strong>关系型数据库是由多张能互相连接的表组成的数据库</strong>。</p>
<p><strong>·优点</strong></p>
<blockquote>
<ul>
<li>都是使用表结构，格式一致，易于维护。</li>
<li>使用通用的 SQL 语言操作，使用方便，可用于复杂查询。</li>
<li>数据存储在磁盘中，安全。</li>
</ul>
</blockquote>
<p><strong>·缺点</strong></p>
<blockquote>
<ul>
<li>读写性能比较差，不能满足海量数据的高效率读写。</li>
<li>不节省空间。因为建立在关系模型上，就要遵循某些规则，比如数据中某字段值即使为空仍要分配空间。</li>
<li>固定的表结构，灵活度较低。</li>
<li>常见的关系型数据库有 Oracle、DB2、PostgreSQL、Microsoft SQL Server、Microsoft Access 和 <strong>MySQL</strong> 等。</li>
</ul>
</blockquote>
<p>（2）非关系型数据库</p>
<p> 非关系型数据库又被称为 NoSQL（Not Only SQL )，意为不仅仅是 SQL。通常指数据以对象的形式存储在数据库中，而<strong>对象之间的关系通过每个对象自身的属性来决定</strong>。</p>
<p><strong>- 优点</strong></p>
<blockquote>
<ul>
<li>非关系型数据库存储数据的格式可以是 key-value 形式、文档形式、图片形式等。使用灵活，应用场景广泛，而关系型数据库则只支持基础类型。</li>
<li>速度快，效率高。NoSQL 可以使用硬盘或者随机存储器作为载体，而关系型数据库只能使用硬盘。</li>
<li>海量数据的维护和处理非常轻松。</li>
<li>非关系型数据库具有扩展简单、高并发、高稳定性、成本低廉的优势。</li>
<li>可以实现数据的分布式处理。</li>
</ul>
</blockquote>
<p><strong>- 缺点</strong></p>
<blockquote>
<ul>
<li>非关系型数据库暂时不提供 SQL 支持，学习和使用成本较高。</li>
<li>非关系数据库没有事务处理，没有保证数据的完整性和安全性。适合处理海量数据，但是不一定安全。</li>
<li>功能没有关系型数据库完善。</li>
</ul>
</blockquote>
<ul>
<li><p>常见的非关系型数据库有 Neo4j、MongoDB、<strong>Redis</strong>、Memcached、MemcacheDB 和 HBase 等。</p>
</li>
<li><p>分类</p>
<p><img src="http://jason-qianhao.xyz/1240-20210630204745513.png"></p>
</li>
<li><p>共同的特点</p>
<ol>
<li>易扩展<br>NoSQL数据库种类繁多，但是一个共同的特点都是去掉关系数据库的关系型特性。数据之间无关系，这样就非常容易扩展。无形之间，在架构的层面上带来了可扩展的能力。<sup> [2]</sup> </li>
<li>数据量，高性能<br>NoSQL数据库都具有非常高的读写性能，尤其在大数据量下，同样表现优秀。这得益于它的无关系性，数据库的结构简单。一般MySQL使用Query Cache。NoSQL的Cache是记录级的，是一种细粒度的Cache，所以NoSQL在这个层面上来说性能就要高很多。</li>
<li>灵活的数据模型<br>NoSQL无须事先为要存储的数据建立字段，随时可以存储自定义的数据格式。而在关系数据库里，增删字段是一件非常麻烦的事情。如果是非常大数据量的表，增加字段简直就是——个噩梦。这点在大数据量的Web 2.0时代尤其明显。<sup> [2]</sup> </li>
<li>高可用<br>NoSQL在不太影响性能的情况，就可以方便地实现高可用的架构。比如Cassandra、HBase模型，通过复制模型也能实现高可用。</li>
</ol>
</li>
</ul>
<h2 id="查询缓存"><a href="#查询缓存" class="headerlink" title="查询缓存"></a>查询缓存</h2><p>（1）执行查询语句时，先查询缓存</p>
<p>（2）MySql8.0后移除，不太实用，可通过redis等高速缓存缓存结果。</p>
<p>（3）弊端：</p>
<ul>
<li>额外的开销，查询后缓存，失效后销毁。</li>
<li>严格匹配才能命中缓存</li>
<li>查询中不能包含不确定语句，否则不缓存</li>
</ul>
<h2 id="存储引擎"><a href="#存储引擎" class="headerlink" title="存储引擎"></a>存储引擎</h2><ul>
<li>作用：负责MySql中数据的存储和提取</li>
<li>服务器通过API与存储引擎通信</li>
</ul>
<h1 id="并发控制"><a href="#并发控制" class="headerlink" title="并发控制"></a>并发控制</h1><p>更详情可以参考：<a target="_blank" rel="noopener" href="https://juejin.cn/post/6878884451162521613">深入理解MySQL锁类型和加锁原理 - 掘金</a></p>
<h2 id="读写锁"><a href="#读写锁" class="headerlink" title="读写锁"></a>读写锁</h2><p>（1）共享锁–读锁</p>
<ul>
<li><p>共享锁（Share Locks，简记为S）又被称为读锁，其他用户可以并发读取数据，但任何事务都不能获取数据上的排他锁，直到已释放所有共享锁。</p>
</li>
<li><p>共享锁(S锁)又称为读锁，若事务T对数据对象A加上S锁，则事务T只能读A；<strong>其他事务只能再对A加S锁，而不能加X锁，直到T释放A上的S锁</strong>。这就保证了其他事务可以读A，但在T释放A上的S锁之前不能对A做任何修改。</p>
</li>
<li><p>用法</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token keyword">LOCK</span> <span class="token operator">IN</span> <span class="token keyword">SHARE</span> <span class="token keyword">MODE</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>Mysql会<strong>对查询结果中的每行都加共享锁</strong>，当没有其他线程对查询结果集中的任何一行使用排他锁时，可以成功申请共享锁，否则会被阻塞。其他线程也可以读取使用了共享锁的表，而且这些线程读取的是同一个版本的数据</p>
</li>
</ul>
<p>（2）排他锁–写锁</p>
<ul>
<li><p>排它锁（(Exclusive lock,简记为X锁)）又称为写锁，<strong>若事务T对数据对象A加上X锁，则只允许T读取和修改A，其它任何事务都不能再对A加任何类型的锁，直到T释放A上的锁</strong>。它防止任何其它事务获取资源上的锁，直到在事务的末尾将资源上的原始锁释放为止。</p>
</li>
<li><p>一个写锁会阻塞其他的写锁和读锁</p>
</li>
<li><p>写锁比读锁有更高的优先级</p>
</li>
<li><p>用法</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token keyword">FOR</span> <span class="token keyword">UPDATE</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>Mysql会<strong>对查询结果中的每行都加排他锁</strong>，当没有其他线程对查询结果集中的任何一行使用排他锁时，可以成功申请排他锁，否则会被阻塞。</p>
<p>在更新操作**(INSERT、UPDATE 或 DELETE**)过程中始终应用排它锁。</p>
</li>
</ul>
<h2 id="锁粒度"><a href="#锁粒度" class="headerlink" title="锁粒度"></a>锁粒度</h2><p>   尽量只锁定需要修改的部分数据，而不是所有的资源。<strong>MySQL存储引擎可以实现自己的锁策略和锁粒度</strong>。</p>
<h3 id="表锁"><a href="#表锁" class="headerlink" title="表锁"></a>表锁</h3><p>特点：</p>
<ul>
<li>锁定整张表</li>
<li>不会出现死锁</li>
<li>开销小</li>
<li>MySql为DDL类语句使用标所，忽略存储引擎的锁机制。</li>
</ul>
<p><strong>表锁共享锁用法</strong>：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">LOCK</span> <span class="token keyword">TABLE</span> table_name <span class="token punctuation">[</span> <span class="token keyword">AS</span> alias_name <span class="token punctuation">]</span> <span class="token keyword">READ</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><strong>表锁排它锁用法</strong>：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">LOCK</span> <span class="token keyword">TABLE</span> table_name <span class="token punctuation">[</span><span class="token keyword">AS</span> alias_name<span class="token punctuation">]</span><span class="token punctuation">[</span> LOW_PRIORITY <span class="token punctuation">]</span> <span class="token keyword">WRITE</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><strong>表锁解锁用法</strong>：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">unlock</span> <span class="token keyword">tables</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="行锁"><a href="#行锁" class="headerlink" title="行锁"></a>行锁</h3><h4 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h4><ul>
<li>锁定当前操作的行</li>
<li>最大程度地支持并发处理</li>
<li>开销大</li>
<li>会出现死锁</li>
</ul>
<h4 id="InnoDB中的行锁分类"><a href="#InnoDB中的行锁分类" class="headerlink" title="InnoDB中的行锁分类"></a>InnoDB中的行锁分类</h4><ul>
<li>Record lock <strong>对索引加锁</strong>，锁定行</li>
<li>Gap lock “间隙”加锁，锁定一个范围（不含索引项本身），防止幻读</li>
<li>Next-Key lock 结合上述两种，锁定索引项本身和索引范围，解决幻读问题</li>
</ul>
<p><img src="http://jason-qianhao.xyz/202206-202212/202206011802806.jpeg"></p>
<p>注意在InnoDB中，具体加锁的方式（<strong>行锁是加在了索引上</strong>）和底层原理</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">update</span> <span class="token keyword">user</span> <span class="token keyword">set</span> age <span class="token operator">=</span> <span class="token number">10</span> <span class="token keyword">where</span> name <span class="token operator">=</span> <span class="token string">'Tom'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="http://jason-qianhao.xyz/202205031114641.image" alt="345.jpg"></p>
<h2 id="InnoDB的死锁"><a href="#InnoDB的死锁" class="headerlink" title="InnoDB的死锁"></a>InnoDB的死锁</h2><p>（1）InnoDB的行级锁是基于索引实现的，如果查询语句为命中任何索引，那么InnoDB会使用表级锁</p>
<p>（2）使用锁的时候，如果<strong>表没有定义任何索引，那么InnoDB会创建一个隐藏的聚簇索</strong>引并使用这个索引来加记录锁。</p>
<p>（3）InnoDB产生死锁原因</p>
<p> 不同于MyISAM总是一次性获得所需的全部锁，InnoDB的锁是逐步获得的，当两个事务都需要获得对方持有的锁，导致双方都在等待，这就产生了死锁。 </p>
<p>发生死锁后，InnoDB一般都可以检测到，并使一个事务释放锁回退（InnoDB目前将持有最少行级排他锁的事务回滚），另一个则可以获取锁完成事务</p>
<p>（4）避免死锁：</p>
<ul>
<li>通过表级锁来减少死锁产生的概率；</li>
<li>多个程序尽量约定以相同的顺序访问表（这也是解决并发理论中哲学家就餐问题的一种思路）；<br>同一个事务尽可能做到一次锁定所需要的所有资源。</li>
</ul>
<h1 id="事务"><a href="#事务" class="headerlink" title="事务"></a>事务</h1><h2 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h2><p>   逻辑上的一组操作，要么都执行，要么都不执行（即回滚，返回上一次正确状态）。</p>
<h2 id="事务四大特性（ACID）"><a href="#事务四大特性（ACID）" class="headerlink" title="事务四大特性（ACID）"></a>事务四大特性（ACID）</h2><p>（1）原子性</p>
<p>   事务是最小的执行单位，不可分割。整个事务中的所有操作要么都提交成功，要么全部失败回滚。</p>
<p>（2）一致性</p>
<p>   执行事务前后，数据保持一致，多个事务对同一个数据读取的结果是相同的。若事务最终没有提交，则事务中所做的修改不会保存到数据库中。</p>
<p>（3）隔离性</p>
<p>  并发访问数据库时，一个用户的事务不被其他事务所干扰，各并发事务之间数据库的数据是独立的。</p>
<p><strong>四种隔离级别</strong></p>
<ul>
<li>READ UNCOMMITTED 未提交读/<strong>脏读</strong>。事务中的修改还没有提交，对其他事务也可见，即其他事务读取了未提交的数据。</li>
<li>READ COMMITTED 提交读/<strong>不可重复读</strong>。一个事务只能“看见”已经提交的事务所做的修改，可能执行两次查询，得到不一样的结果。</li>
<li>REPEATABLE READ 可重复读/<strong>幻读</strong>。<strong>是MySQL的默认事务隔离级别</strong>，保证了在同一个事务中多次读取同样记录的结果一致。可能发生幻读：一个事务在读取某个范围内的记录时，另一个事务在范围内插入记录，导致<strong>幻行</strong>。通过<strong>MVCC</strong>多版本并发控制解决问题。</li>
<li>SERIALIZEABLE 可串行化。最高的隔离级别，强制事务串行执行。本质是在读取的每一行数据上都加锁。</li>
</ul>
<p><img src="http://jason-qianhao.xyz/202205031034966.png" alt="img"></p>
<p>（4）持久性</p>
<p>   一旦事务提交，则其所做的修改就会永久保存到数据库中。</p>
<h2 id="事务日志"><a href="#事务日志" class="headerlink" title="事务日志"></a>事务日志</h2><ul>
<li><strong>存储引擎在修改表的数据时，只需要修改其内存的拷贝</strong>，再把修改行为记录到持久在硬盘的事务日志中。</li>
<li>即修改数据，需要写两次磁盘。</li>
<li>若系统崩溃，可通过日志自动恢复数据</li>
</ul>
<h2 id="MySQL中的事务"><a href="#MySQL中的事务" class="headerlink" title="MySQL中的事务"></a>MySQL中的事务</h2><p>（1）MySQL默认采用自动提交模式。即如果不显式地开始一个事务，则每个查询都被当做一个事务执行提交操作。</p>
<p>（2）显式和隐式锁定</p>
<ul>
<li>隐式：事务执行过程中，随时都可以执行锁定，锁只有在执行COMMIT或者ROLLBACK的时候才会释放锁</li>
<li>显式：在MySQL语句中使用LOCK TABLES或者UNLOCK TABLES。</li>
</ul>
<h1 id="MVCC多版本并发控制"><a href="#MVCC多版本并发控制" class="headerlink" title="MVCC多版本并发控制"></a>MVCC多版本并发控制</h1><h2 id="特性"><a href="#特性" class="headerlink" title="特性"></a>特性</h2><p>   MVCC是行级锁的一个变种，但是它在很多情况下避免了加锁操作，因此开销更低。虽然不同数据库的实现机制有所不同，但大都实现了非阻塞的读操作，写操作也只锁定必要的行。</p>
<p>  <strong>MVCC</strong>在<strong>MySQL InnoDB</strong>中的实现主要是为了提高数据库并发性能，用更好的方式去处理读-写冲突，做到即使有读写冲突时，也能做到不加锁，非阻塞并发读</p>
<h2 id="相关概念"><a href="#相关概念" class="headerlink" title="相关概念"></a>相关概念</h2><h3 id="快照-snapshot"><a href="#快照-snapshot" class="headerlink" title="快照 snapshot"></a>快照 snapshot</h3><p>（1）事务快照是用来存储数据库的事务运行情况</p>
<p>（2）生成时机</p>
<ul>
<li><p>在innodb中(默认repeatable read级别), 事务在begin/start transaction之后的第一条select读操作后, 会创建一个快照(read view), 将当前系统中活跃的其他事务记录记录起来; </p>
</li>
<li><p>在innodb中(READ COMMITTED级别), 事务中每条select语句都会创建一个快照(read view);</p>
</li>
<li><p>Read View 存放着一个列表，这个列表用来记录当前数据库系统中活跃的读写事务，也就是已经开启了，正在进行数据操作但是还未提交保存的事务。可以通过这个列表来判断某一个版本是否对当前事务可见。其中，有四个重要的字段：</p>
<p>creator_trx_id：创建当前Read View所对应的事务ID</p>
<p>m_ids：所有当前未提交事务的事务ID，也就是活跃事务的事务id列表</p>
<p>min_trx_id：m_ids里最小的事务id值</p>
<p>max_trx_id：InnoDB 需要分配给下一个事务的事务ID值（事务 ID 是累计递增分配的，所以后面分配的事务ID一定会比前面的大！）</p>
<p><img src="http://jason-qianhao.xyz/202206-202212/202206011810111.jpeg"></p>
</li>
</ul>
<h3 id="undo-log"><a href="#undo-log" class="headerlink" title="undo-log"></a>undo-log</h3><p>（1）当我们对记录做了变更操作时就会产生undo记录</p>
<p>（2）Undo记录中存储的是老版本数据。当一个旧的事务需要读取数据时，为了能读取到老版本的数据，需要顺着undo链找到满足其可见性的记录</p>
<h3 id="redo-log"><a href="#redo-log" class="headerlink" title="redo-log"></a>redo-log</h3><p>存储变更后的数据</p>
<h2 id="InnoDB实现的MVCC"><a href="#InnoDB实现的MVCC" class="headerlink" title="InnoDB实现的MVCC"></a>InnoDB实现的MVCC</h2><h3 id="InnoDB存储引擎在数据库每行数据的后面添加了三个字段"><a href="#InnoDB存储引擎在数据库每行数据的后面添加了三个字段" class="headerlink" title="InnoDB存储引擎在数据库每行数据的后面添加了三个字段"></a>InnoDB存储引擎在数据库每行数据的后面添加了三个字段</h3><p>   字段称之为系统版本号。</p>
<p>（1） 事务ID DB_TRX_ID</p>
<p> 用来标识最近一次对本行记录做修改(insert|update)的事务的标识符, 即最后一次修改(insert|update)本行记录的事务id。 </p>
<p> 至于delete操作，在innodb看来也不过是一次update操作，更新行中的一个特殊位将行表示为deleted, 并非真正删除。</p>
<p>（2）回滚指针 DB_ROLL_PTR</p>
<p>指写入回滚段(rollback segment)的 undo log record (撤销日志记录记录)。 如果一行记录被更新, 则 undo log record 包含 ‘重建该行记录被更新之前内容’ 所必须的信息</p>
<p>（3） 新行插入而单调递增的ID DB_ROW_ID</p>
<p>如果我们的表中没有主键或合适的唯一索引, 也就是无法生成聚簇索引的时候, InnoDB会帮我们自动生成聚集索引, 但聚簇索引会使用DB_ROW_ID的值来作为主键; 如果我们有自己的主键或者合适的唯一索引, 那么聚簇索引中也就不会包含 DB_ROW_ID 了</p>
<h3 id="更新步骤"><a href="#更新步骤" class="headerlink" title="更新步骤"></a>更新步骤</h3><img src="http://jason-qianhao.xyz/1240-20210630204745607.png" alt="image"/>

<p>（1）排他锁锁定该行</p>
<p>（2）记录redo-log</p>
<p>（3）将修改前的值复制到undo-log</p>
<p>（4）修改当前行的值，填写事务编号，使用回滚指针，指向Undo-log中的修改前的行</p>
<h3 id="当前读和快照读"><a href="#当前读和快照读" class="headerlink" title="当前读和快照读"></a>当前读和快照读</h3><p>InnoDB存储引擎默认的事务隔离级别是REPEATABLE-READ。通过 “行排他锁+MVCC” 一起实现的, 不仅可以保证可重复读, 还可以防止幻读。</p>
<p>（1）当前读</p>
<p>如select … lock in share mode， select … for update ，insert，update，delete操作，在RR级别下，使用<strong>record lock 和 gap lock</strong>来实现的。</p>
<p>（2）快照读</p>
<p> 如简单的select操作(当然不包括 select … lock in share mode, select … for update)，是通过<strong>MVVC(多版本控制)和undo log</strong>来实现的。</p>
<ul>
<li>REPEATABLE-READ 此时在第一次读操作时，生成Read View数据（快照），所以可以重复读取，MVCC的活跃事务列表记录后面<strong>所有</strong>事务，所以可以读到历史版本数据。</li>
<li>READ COMMITTED <strong>每次读取数据前都生成一个ReadView ，</strong>所以不能重复读取，MVCC的活跃事务列表记录此时后面的<strong>未提交</strong>的事务，只能读到新版本的数据。</li>
</ul>
<blockquote>
<p>参考：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/flying_hengfei/article/details/106965517">MVCC到底是什么？这一篇博客就够啦_flying_hengfei的博客-CSDN博客_mvcc作用</a></li>
<li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/aspirant/p/9177978.html">Mysql 间隙锁原理，以及Repeatable Read隔离级别下可以防止幻读原理(百度) - aspirant - 博客园</a></li>
<li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/wwcom123/p/10727194.html">【MySQL】当前读、快照读、MVCC - wwcom123 - 博客园</a></li>
<li><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/fd7srpXxo-7GrXl5Q8Hkkw">https://mp.weixin.qq.com/s/fd7srpXxo-7GrXl5Q8Hkkw</a></li>
</ul>
</blockquote>
<h3 id="工作环境"><a href="#工作环境" class="headerlink" title="工作环境"></a>工作环境</h3><p>仅在两个隔离级别下工作，REPEATABLE READ(可重复读)和READ COMMITTED（提交读）。</p>
<h1 id="存储引擎-1"><a href="#存储引擎-1" class="headerlink" title="存储引擎"></a>存储引擎</h1><h2 id="查看表的存储引擎"><a href="#查看表的存储引擎" class="headerlink" title="查看表的存储引擎"></a>查看表的存储引擎</h2><p>show table status like “table_name”</p>
<h2 id="InnoDB对数据的读写"><a href="#InnoDB对数据的读写" class="headerlink" title="InnoDB对数据的读写"></a>InnoDB对数据的读写</h2><p><strong>InnoDB处理数据的过程是发生在内存中的</strong>，需要把磁盘中的数据加载到内存中，如果是处理写入或修改请求的话，还<strong>需要把内存中的内容刷新到磁盘上</strong>。</p>
<p>读写磁盘的速度非常慢，和内存读写差了几个数量级，所以当我们想从表中获取某些记录时，InnoDB存储引擎将数据划分为若干个页，以页作为磁盘和内存之间交互的基本单位，InnoDB中页的大小默认为 16 KB。也就是在一般情况下，一次最少从磁盘中读取16KB的内容到内存中，或者一次最少把内存中的16KB内容刷新到磁盘中。</p>
<img src="http://jason-qianhao.xyz/202206-202212/202206011404173.png" style="zoom:67%;" />

<p>所以当你用postman测试一个分页查询接口时，发现第一次打印耗时300 ~ 400ms，往后不停的查找下一页都是30 ~ 40ms，原因就是第一次请求接口时，读数据库的时候需要读磁盘，从磁盘加载16KB的数据到内存，往后下一页的数据都是从内存中获取，没有再读磁盘，除非在内存中的16KB的数据中找不到，才会再次读磁盘获取下一个16KB的数据到内存中。</p>
<h2 id="MyISAM和InnoDB对比"><a href="#MyISAM和InnoDB对比" class="headerlink" title="MyISAM和InnoDB对比"></a>MyISAM和InnoDB对比</h2><p>MySQL 5.5版本后默认的存储引擎为InnoDB。</p>
<p>（1）锁机制</p>
<p>MyISAM只有表级锁，InnoDB支持行级锁（默认）和表级锁。</p>
<p>（2）事务</p>
<p>MyISAM不支持事务，InnoDB事务安全</p>
<p>（3）查询和添加速度</p>
<p> MyISAM每次查询具有原子性，执行速度比InnoDB快。</p>
<p>（4）外键</p>
<p> MyISAM不支持，而InnoDB支持</p>
<blockquote>
<p>主键和外键参考：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/liuslayer/p/9082297.html">（转）关于数据库主键和外键（终于弄懂啦） - liuslayer - 博客园</a></p>
</blockquote>
<p>（5）MVCC</p>
<p>MyISAM不支持，而InnoDB支持</p>
<p>（6）索引</p>
<ul>
<li><p>MyISAM的叶节点是数据记录的地址，即为“非聚集索引”。</p>
</li>
<li><p>InnoDB叶节点是完整的数据记录，即为“聚集索引”，索引的Key为数据表的主键。所以InnoDB表数据文件本身就是主索引，其余索引都是辅助索引，data中记录了主键的值而不是地址。</p>
<p>   因为InnoDB的数据文件本身要<strong>按主键聚集</strong>，所以InnoDB要求表必须有主键（MyISAM可以没有），如果没有显式指定，则MySQL系统会自动选择一个可以唯一标识数据记录的列作为主键，如果不存在这种列，则MySQL自动为InnoDB表生成一个隐含字段作为主键，这个字段长度为6个字节，类型为长整形。</p>
<p> 聚集索引这种实现方式使得按主键的搜索十分高效，<strong>但是辅助索引搜索需要检索两遍索引</strong>（需要回表操作）：首先检索辅助索引获得主键，然后用主键到主索引中检索获得记录。</p>
<blockquote>
<p>聚集索引参考：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/aspnethot/articles/1504082.html">聚集索引和非聚集索引（整理） - 布颜书 - 博客园</a></p>
</blockquote>
</li>
</ul>
<p><strong>· 注意</strong><br>   “聚集索引”是一种数据存储方式，同时保存索引和数据行。一个表中只能有一个聚集索引。</p>
<h1 id="索引"><a href="#索引" class="headerlink" title="索引"></a>索引</h1><h2 id="意义"><a href="#意义" class="headerlink" title="意义"></a>意义</h2><p>索引用来快速地寻找那些具有特定值的记录，<strong>所有MySQL索引都以B+树的形式保存</strong>。如果没有索引，执行查询时MySQL必须<strong>从第一个记录开始扫描整个表的所有记录</strong>，直至找到符合要求的记录。</p>
<h2 id="实现原理"><a href="#实现原理" class="headerlink" title="实现原理"></a>实现原理</h2><h3 id="B-Tree索引"><a href="#B-Tree索引" class="headerlink" title="B+Tree索引"></a>B+Tree索引</h3><p><img src="http://jason-qianhao.xyz/1240-20210630204745528.png" alt="image"></p>
<p>（1）按顺序存储值，每一个叶子节点到根距离相同。</p>
<p>（2）B+Tree：叶节点指向下一个叶节点，方便叶节点遍历</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/bengshakalakaka/article/details/89255902">B树与B+树与磁盘读取的联系_键盘上的青春-CSDN博客_b树 磁盘</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_35571554/article/details/82796278?utm_medium=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-1.control&dist_request_id=&depth_1-utm_source=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-1.control">深入理解数据库索引采用B树和B+树的原因_菜鸟不会飞-CSDN博客_b树和b+树</a></p>
<h3 id="哈希索引"><a href="#哈希索引" class="headerlink" title="哈希索引"></a>哈希索引</h3><p>（1）基于哈希表实现，存储引擎会对所有的索引列计算一个哈希码</p>
<p>（2）在为单条记录查询时，选择哈希更快</p>
<p>（3）自适应哈希索引（InnoDB）：当索引值被使用非常频繁时，基于B-Tree索引上再建一个哈希索引。</p>
<p>（4）避免哈希冲突：在WHERE条件中带入哈希值和对应列值。</p>
<h2 id="分类"><a href="#分类" class="headerlink" title="分类"></a>分类</h2><p>（1）主键索引</p>
<ul>
<li><p>唯一性索引，必须指定为“PRIMARY KEY”。每个表只能有一个主键，主键也不能为空</p>
</li>
<li><p>方式：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> tablename <span class="token punctuation">(</span> <span class="token punctuation">[</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>列的列表<span class="token punctuation">)</span> <span class="token punctuation">)</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> tablename <span class="token keyword">ADD</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>列的列表<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li>
</ul>
<p>（2）全文索引</p>
<ul>
<li><p>FULLTEXT (title,body)，查找的是文本中的关键词</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> articles <span class="token keyword">where</span> <span class="token keyword">match</span><span class="token punctuation">(</span>title<span class="token punctuation">,</span>body<span class="token punctuation">)</span> against <span class="token punctuation">(</span> <span class="token string">'database'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
</ul>
<p>（3）普通索引    </p>
<ul>
<li>普通索引（由关键字KEY或INDEX定义的索引）的唯一任务是加快对数据的访问速度</li>
<li>create index 索引名 on 表 (列1,列名2);</li>
</ul>
<p>（4）唯一 索引</p>
<ul>
<li>索引列的所有值都只能出现一次，即必须唯一。</li>
<li>CREATE UNIQUE INDEX &lt;索引的名字&gt; ON tablename (列的列表)</li>
</ul>
<p>（5）组合索引</p>
<p>参考：<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/40edfbb50046">普通索引和组合索引 - 简书</a></p>
<ul>
<li><p>单列索引，即一个索引只包含单个列，一个表可以有多个单列索引，但这不是组合索引；</p>
</li>
<li><p> 组合索引，即一个索包含多个列。</p>
</li>
</ul>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> mytable <span class="token keyword">ADD</span> <span class="token keyword">INDEX</span> name_city_age <span class="token punctuation">(</span>name<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>city<span class="token punctuation">,</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p> 建立这样的组合索引，其实是相当于分别建立了下面三组组合索引：</p>
<p><code> usernname,city,age</code>、<code>usernname,city</code>、 <code>usernname</code></p>
<p> 为什么没有 city，age这样的组合索引呢? 这是因为MySQL组合索引<strong>“最左前缀”的结果。简单的理解就是只从最左面的开始组合</strong></p>
<p><strong>注意区别</strong></p>
<ul>
<li>主键创建后一定包含一个唯一性索引，唯一性索引并不一定就是主键。</li>
<li>唯一性索引列允许空值，而主键列不允许为空值。</li>
<li>主键列在创建时，已经默认为空值 + 唯一索引了。</li>
<li>主键可以被其他表引用为外键，而唯一索引不能。</li>
<li>一个表最多只能创建一个主键，但可以创建多个唯一索引。</li>
<li>主键更适合那些不容易更改的唯一标识，如自动递增列、身份证号等。</li>
<li>在 RBO 模式下，主键的执行计划优先级要高于唯一索引。 两者可以提高查询的速度。</li>
</ul>
<p>其他参考资料：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/luyucheng/p/6289714.html">索引的分类</a></p>
<h2 id="主键索引和辅助索引的存储结构和查询过程"><a href="#主键索引和辅助索引的存储结构和查询过程" class="headerlink" title="主键索引和辅助索引的存储结构和查询过程"></a>主键索引和辅助索引的存储结构和查询过程</h2><p>参考：<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_34294121/article/details/101632347">MySQL的数据结构以及辅助索引的使用_MemoForward的博客-CSDN博客_mysql辅助索引</a></p>
<p>这里提供一个数据库表。我们假设：id为主键索引，name为辅助索引。</p>
<table>
<thead>
<tr>
<th>id</th>
<th>name</th>
<th>gender</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>cxy</td>
<td>male</td>
</tr>
<tr>
<td>2</td>
<td>lhw</td>
<td>female</td>
</tr>
<tr>
<td>3</td>
<td>tyy</td>
<td>female</td>
</tr>
<tr>
<td>4</td>
<td>dsx</td>
<td>male</td>
</tr>
</tbody></table>
<p>InooDB索引结构是B+Tree，其索引就是一个个key。但是<strong>主键索引和辅助索引在叶子节点的存储结构上有一点不同</strong>。</p>
<ul>
<li><p>对于主键索引，其存储结构可能如下（仅做示意）</p>
<p><img src="http://jason-qianhao.xyz/image-20220309103430624.png" alt="image-20220309103430624"></p>
<p>因此若执行select * from this_table where id = 3，就会执行：</p>
<p><img src="http://jason-qianhao.xyz/image-20220309103513340.png" alt="image-20220309103513340"></p>
</li>
<li><p>辅助索引结构示意图：顺序是ASCII码</p>
<p><img src="http://jason-qianhao.xyz/image-20220309103535679.png" alt="image-20220309103535679"></p>
<p>可见，<strong>辅助索引中存储的是主键索引，而不是真正的数据值。</strong><br>因此若执行select * from this_table where name = cxy，就会执行</p>
<p><img src="http://jason-qianhao.xyz/image-20220309103556999.png" alt="image-20220309103556999"></p>
<p><strong>从辅助索引回到主键索引树搜索的过程，即为回表</strong></p>
</li>
<li><p><strong>注意</strong></p>
<ul>
<li><strong>InooDB引擎必须要有主键，因为整个引擎都是以主键构成的B+Tree结构而存在的。如果我们不指定主键，mysql会自动给我们创建一个隐藏的主键。</strong></li>
<li>InooDB的主键最好设置成：与业务无关且自增。 我们观察BTree的结构，一旦插入值，这个结构就要重建，很费时，如果主键是自增的，可以减少插入数据时BTree树的更新时间(降低数据写入的时间)。</li>
<li>辅助索引如果不手动创建，MySQL是不会帮我们创建的，如果没有辅助索引，我们通过name来找数据的时候，搜索复杂度是O(n)，非常耗时。</li>
<li>辅助索引并不是越多越好。 我们观察整个搜索流程会发现，辅助索引通过牺牲空间的方式来提升查询速度，如果辅助索引过多，必然会造成空间的浪费。</li>
</ul>
</li>
</ul>
<h2 id="覆盖索引"><a href="#覆盖索引" class="headerlink" title="覆盖索引"></a>覆盖索引</h2><p>参考：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_15037231/article/details/87891683">什么是覆盖索引?如何利用覆盖索引进行SQL语句优化？_斜阳雨陌-CSDN博客_覆盖索引</a></li>
<li><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s?__biz=Mzg5NjMxMTYxNQ==&mid=2247488048&idx=1&sn=a5b62a41b83350644a919b49de78ee59&source=41#wechat_redirect">为什么覆盖索引可以加快查询</a></li>
</ul>
<p>SQL只需要通过索引就可以返回查询所需要的数据，而不必通过二级索引查到主键之后再去查询数据。<strong>即避免回表查询</strong></p>
<p>列如：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> id <span class="token keyword">from</span> <span class="token keyword">user</span> <span class="token keyword">where</span> age<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>直接在age索引树中就能查询到id的值，不用再去id索引树中查找其他的数据，避免了<strong>回表</strong>。</p>
<h2 id="强制索引"><a href="#强制索引" class="headerlink" title="强制索引"></a>强制索引</h2><p>参考：<a target="_blank" rel="noopener" href="https://www.lmlphp.com/user/552/article/item/33599/">mysql优化之强制索引</a></p>
<p>在某些字段已经加了索引的情况下 ，仍然使用的是ALL扫描全表查资料，得出原因是因为mysql优化器认为走全表扫描更快那么此时就需要告诉优化器，强制使用XXX索引，可以增快查询速度。</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">explain</span>
<span class="token keyword">SELECT</span>
	city_name<span class="token punctuation">,</span>
	hourflag<span class="token punctuation">,</span>
	eletricflag
<span class="token keyword">FROM</span>
	t_eletric_segment_info
<span class="token keyword">force</span> <span class="token keyword">index</span><span class="token punctuation">(</span>index_hourflag<span class="token punctuation">)</span>
<span class="token keyword">WHERE</span>
	hourflag <span class="token operator">>=</span> <span class="token string">'2019032600'</span>
<span class="token operator">AND</span>
	hourflag <span class="token operator">&lt;=</span> <span class="token string">'2019040123'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="查询索引命令"><a href="#查询索引命令" class="headerlink" title="查询索引命令"></a>查询索引命令</h2><ul>
<li>show index from 表名</li>
<li>show keys from 表名</li>
</ul>
<h2 id="使用索引的代价"><a href="#使用索引的代价" class="headerlink" title="使用索引的代价"></a>使用索引的代价</h2><p>对DML(update、delete、insert)语句的效率，增删改会对索引影响，因为索引要重新整理。</p>
<h2 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h2><p>（1）存储引擎对索引的支持</p>
<p><img src="http://jason-qianhao.xyz/1240-20220308113957522.png" alt="image"></p>
<p>（2）什么时候加索引</p>
<ul>
<li>查询作为查询条件字段应该创建索引</li>
<li>唯一性太差的字段不适合单独创建索引,即使频繁 <code>Select * from emp where sex=’男’</code></li>
<li>频繁更新字段，也不要定义索引。</li>
<li>不会出现在where语句的字段不要创建索引</li>
</ul>
<p>（3）索引失效</p>
<ul>
<li>模糊查询在like前面有百分号开头会失效。有很多的优化逻辑，其中一个是，使用<a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/zDJpqXOCGSrWfyaq68jR1Q">全文索引代替like进行优化</a></li>
<li>如果条件中有or，即使其中有条件带索引也不会使用。换言之，就是要求使用的所有字段，都必须建立索引, 我们建议大家尽量避免使用or 关键字</li>
</ul>
<h1 id="Explain命令"><a href="#Explain命令" class="headerlink" title="Explain命令"></a>Explain命令</h1><p>explain显示了mysql如何使用索引来处理select语句以及连接表。可以帮助选择更好的索引和写出更优化的查询语句。</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp <span class="token keyword">where</span> name <span class="token operator">=</span> <span class="token string">'Jefabc'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="http://jason-qianhao.xyz/202206-202212/202206011437556.png" alt="img"></p>
<p>expain出来的信息有10列，分别是id、select_type、table、type、possible_keys、key、key_len、ref、rows、Extra</p>
<h2 id="id"><a href="#id" class="headerlink" title="id"></a>id</h2><p>SELECT识别符。这是SELECT的查询序列号</p>
<ol>
<li>如果是子查询，id的序号会递增，id值越大优先级越高，越先被执行</li>
<li>id如果相同，可以认为是一组，从上往下顺序执行；在所有组中，id值越大，优先级越高，越先执行</li>
</ol>
<h2 id="select-type"><a href="#select-type" class="headerlink" title="select_type"></a>select_type</h2><p>查询中每个select子句的类型</p>
<p>(1) SIMPLE(简单SELECT，不使用UNION或子查询等)</p>
<p>(2) PRIMARY(子查询中最外层查询，查询中若包含任何复杂的子部分，最外层的select被标记为PRIMARY)</p>
<p>(3) UNION(UNION中的第二个或后面的SELECT语句)</p>
<p>(4) DEPENDENT UNION(UNION中的第二个或后面的SELECT语句，取决于外面的查询)</p>
<p>(5) UNION RESULT(UNION的结果，union语句中第二个select开始后面所有select)</p>
<p>(6) SUBQUERY(子查询中的第一个SELECT，结果不依赖于外部查询)</p>
<p>(7) DEPENDENT SUBQUERY(子查询中的第一个SELECT，依赖于外部查询)</p>
<p>(8) DERIVED(派生表的SELECT, FROM子句的子查询)</p>
<p>(9) UNCACHEABLE SUBQUERY(一个子查询的结果不能被缓存，必须重新评估外链接的第一行)</p>
<h2 id="table"><a href="#table" class="headerlink" title="table"></a>table</h2><p>显示这一步所访问数据库中表名称（显示这一行的数据是关于哪张表的），有时不是真实的表名字，可能是简称。</p>
<h2 id="type"><a href="#type" class="headerlink" title="type"></a>type</h2><p>对表访问方式，表示MySQL在表中找到所需行的方式，又称“访问类型”。</p>
<p>常用的类型有： <strong>ALL、index、range、 ref、eq_ref、const、system、NULL（从左到右，性能从差到好）</strong></p>
<ul>
<li><p>ALL：Full Table Scan， MySQL将遍历全表以找到匹配的行</p>
</li>
<li><p>index: Full Index Scan，index与ALL区别为index类型只遍历索引树</p>
</li>
<li><p>range:只检索给定范围的行，使用一个索引来选择行</p>
</li>
<li><p>ref: 表示上述表的连接匹配条件，即哪些列或常量被用于查找索引列上的值</p>
</li>
<li><p>eq_ref: 类似ref，区别就在使用的索引是<strong>唯一索引</strong>，对于每个索引键值，表中只有一条记录匹配，简单来说，就是多表连接中使用primary key或者 unique key作为关联条件</p>
</li>
<li><p>const、system: 当MySQL对查询某部分进行优化，并转换为一个常量时，使用这些类型访问。如将主键置于where列表中，MySQL就能将该查询转换为一个常量，system是const类型的特例，当查询的表只有一行的情况下，使用system</p>
</li>
<li><p>NULL: MySQL在优化过程中分解语句，执行时甚至不用访问表或索引，例如从一个索引列里选取最小值可以通过单独索引查找完成。</p>
</li>
</ul>
<h2 id="possible-keys"><a href="#possible-keys" class="headerlink" title="possible_keys"></a>possible_keys</h2><p>指出MySQL能使用哪个索引在表中找到记录，查询涉及到的字段上若存在索引，则该索引将被列出，但不一定被查询使用（该查询可以利用的索引，如果没有任何索引显示 null)</p>
<h2 id="key"><a href="#key" class="headerlink" title="key"></a>key</h2><p><strong>key列显示MySQL实际决定使用的键（索引），必然包含在possible_keys中</strong></p>
<p>如果没有选择索引，键是NULL。要想强制MySQL使用或忽视possible_keys列中的索引，在查询中使用FORCE INDEX、USE INDEX或者IGNORE INDEX。</p>
<h2 id="key-len"><a href="#key-len" class="headerlink" title="key_len"></a>key_len</h2><p><strong>表示索引中使用的字节数，可通过该列计算查询中使用的索引的长度（key_len显示的值为索引字段的最大可能长度，并非实际使用长度，即key_len是根据表定义计算而得，不是通过表内检索出的）</strong></p>
<p>不损失精确性的情况下，长度越短越好 </p>
<h2 id="ref"><a href="#ref" class="headerlink" title="ref"></a>ref</h2><p>这一列显示了在key列记录的索引中，表查找值所用到的列或常量，常见的有：const（常量），func，NULL，字段名（例：film.id）</p>
<h2 id="rows"><a href="#rows" class="headerlink" title="rows"></a>rows</h2><p>这一列是mysql估计要读取并检测的行数，注意这个不是结果集里的行数。</p>
<h2 id="extra"><a href="#extra" class="headerlink" title="extra"></a>extra</h2><p><strong>该列包含MySQL解决查询的详细信息</strong></p>
<ul>
<li>**<code>distinct</code>**： 一旦mysql找到了与行相联合匹配的行，就不再搜索了</li>
<li>**<code>Using index</code>**：这发生在对表的请求列都是同一索引的部分的时候，返回的列数据只使用了索引中的信息，而没有再去访问表中的行记录。是性能高的表现。一遍出现在覆盖索引查询的情况。</li>
<li><code>Using index condition</code>：MySQL5.6 之后新增的 ICP，using index condtion 就是使用了 ICP（索引下推），在存储引擎层进行数据过滤，而不是在服务层过滤，利用索引现有的数据减少回表的数据。</li>
<li>**<code>Using where</code>**：mysql服务器将在存储引擎检索行后再进行过滤。就是先读取整行数据，再按 where 条件进行检查，符合就留下，不符合就丢弃。</li>
<li>**<code>Using temporary</code>**：mysql需要创建一张临时表来处理查询，常见于排序和分组查询，常见 group by ，order by。出现这种情况一般是要进行优化的，首先是想到用索引来优化。</li>
<li>**<code>Using filesort</code>**：mysql 会对结果使用一个外部索引排序，而不是按索引次序从表里读取行。此时mysql会根据联接类型浏览所有符合条件的记录，并保存排序关键字和行指针，然后排序关键字并按顺序检索行信息。这种情况下一般也是要考虑使用索引来优化的。</li>
</ul>
<p>更具体可以参考：</p>
<ul>
<li><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/tufujie/p/9413852.html">https://www.cnblogs.com/tufujie/p/9413852.html</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/zcyNB/p/15068294.html">https://www.cnblogs.com/zcyNB/p/15068294.html</a></p>
</li>
</ul>
<h1 id="数据库连接的耗时分析"><a href="#数据库连接的耗时分析" class="headerlink" title="数据库连接的耗时分析"></a>数据库连接的耗时分析</h1><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"com.mysql.jdbc.Driver"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> name <span class="token operator">=</span> <span class="token string">"shine_user"</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> password <span class="token operator">=</span> <span class="token string">"123"</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> url <span class="token operator">=</span> <span class="token string">"jdbc:mysql://172.16.100.131:3306/clever_mg_test"</span><span class="token punctuation">;</span>
<span class="token class-name">Connection</span> conn <span class="token operator">=</span> <span class="token class-name">DriverManager</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> name<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span>
conn<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="http://jason-qianhao.xyz/202206-202212/202206011815902.png"></p>
<ul>
<li><strong>第 1 步：</strong>此时处于 MySQL 通信协议阶段，客户端发送关闭连接请求，而且不用等待服务端的响应。</li>
<li><strong>第 2 步：</strong>TCP 断开连接，4 次挥手完成连接断开。</li>
</ul>
<p>这里是完整地完成了从数据库连接的建立到关闭，整个过程花费了：</p>
<pre class="line-numbers language-none"><code class="language-none">747.284311 - 747.100954 &#x3D; 0.183357s &#x3D; 183.357ms<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>这里可能也有网络状况的影响，比上述的 225ms 少了，但是也几乎达到了 200ms 的级别。那么问题来了，想象一下这个场景，对于一个日活 2 万的网站来说，假设每个用户只会发送 5 个请求，那么一天就是 10 万个请求。对于建立数据库连接，我们保守一点计算为 150ms 好了，那么一天当中花费在建立数据库连接的时间有（还不包括执行查询和更新操作）：</p>
<pre class="line-numbers language-none"><code class="language-none">100000 * 150ms &#x3D; 15000000ms &#x3D; 15000s &#x3D; 250min &#x3D; 4.17h<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>也就说每天花费在建立数据库连接上的时间已经达到「4 个小时」，所以说数据库连接池是必须的嘛。</p>
<p>而且当日活增加时，单单使用数据库连接池也不能完全保证你的服务能够正常运行，还需要考虑其他的解决方案。</p>
<h1 id="一张数据库表的最大记录数"><a href="#一张数据库表的最大记录数" class="headerlink" title="一张数据库表的最大记录数"></a>一张数据库表的最大记录数</h1><p>MySQL本身并没有对单表最大记录数进行限制，这个数值取决于你的操作系统对单个文件的限制本身。业界流传是500万行。超过500万行就要考虑分表分库了。</p>
<blockquote>
<p>阿里巴巴《Java 开发手册》提出单表行数超过 500 万行或者单表容量超过 2GB，才推荐进行分库分表。</p>
</blockquote>
<p>事实上，MySql数据库一张表中能存储的最大数据量和实际记录的条数无关，而与 MySQL 的配置以及机器的硬件有关。因为，MySQL 为了提高性能，会将表的索引装载到内存中。<code>InnoDB buffer size</code> 足够的情况下，其能完成全加载进内存，查询不会有问题。</p>
<p>但是，当单表数据库到达某个量级的上限时，导致内存无法存储其索引，使得之后的 SQL 查询会<strong>产生磁盘 IO</strong>，从而导致性能下降。当然，这个还有具体的表结构的设计有关，最终导致的问题都是内存限制。</p>
<h1 id="MySql扩展"><a href="#MySql扩展" class="headerlink" title="MySql扩展"></a>MySql扩展</h1><h2 id="分表分库"><a href="#分表分库" class="headerlink" title="分表分库"></a>分表分库</h2><p>（1）垂直拆分（拆分列）<br>        垂直拆分就是要把表按模块划分到不同<strong>数据库</strong>表中（当然原则还是不破坏第三范式）。例如分布式情况下，为将一个项目进行拆分成多个子模块，每个子模块有单独数据库（解耦数据）。</p>
<p>（2）水平拆分（拆分行）<br>        水平切分就是要把一个表按照某种规则把数据划分到不同表或数据库里。例如时间规则、地点、日志等，还有哈希算法。</p>
<p>（3）id主键处理方式</p>
<ul>
<li>UUID  适用于生成文件名，不适合作为主键，因为太长了。</li>
<li>不同步自增id，如主奇从偶</li>
<li>redis生成id，但是让系统更复杂</li>
</ul>
<h2 id="读写分离"><a href="#读写分离" class="headerlink" title="读写分离"></a>读写分离</h2><p>（1）主从复制</p>
<ul>
<li>原理，主数据库将二进制日志文件（bin-log）传给从数据库。</li>
<li>触发时刻：从数据库监控主数据库二进制文件的变化，发生变化则通过IO线程进行二进制文件的复制和传输。</li>
<li>意义<pre><code>  - 数据丢失和备份
  - 读写分离
  - 负载均衡，高可用
</code></pre>
</li>
</ul>
<p>（2）读写分离</p>
<ul>
<li>定义：主数据库负责助理事务，从数据库负责读操作</li>
<li>意义<pre><code>      - 分摊服务器压力，提高机器的系统处理效率
      - 增加冗余，提高系统可用性，可以在主数据库宕机式进行数据恢复
</code></pre>
</li>
</ul>
<h2 id="系统扩展"><a href="#系统扩展" class="headerlink" title="系统扩展"></a>系统扩展</h2><p>（1）垂直扩展（scale-up），在单机器上加存储、加内存、加CPU</p>
<p>（2）水平扩展（scale-out）， 加机器数量，做集群</p>
<h2 id="MyCat-中间件"><a href="#MyCat-中间件" class="headerlink" title="MyCat 中间件"></a>MyCat 中间件</h2><p>（1）作用：分发请求，保证安全、读写分离、高可用、负载均衡</p>
<p>（2）原理：对数据进行分片处理，所有的分片数据库集群构成完整的数据库存储</p>
<p><strong>· 阿里的rds系统</strong><br>即开即用的关系型数据库服务，提供了强大丰富的功能，保证高可用性、安全性、高性能。</p>
<h1 id="其他知识点"><a href="#其他知识点" class="headerlink" title="其他知识点"></a>其他知识点</h1><h2 id="存储过程和函数"><a href="#存储过程和函数" class="headerlink" title="存储过程和函数"></a>存储过程和函数</h2><p>（1）就是一组SQL语句集，功能强大，可以实现一些比较复杂的逻辑功能，类似于JAVA语言中的方法。</p>
<p>（2）存储过程特性：</p>
<ul>
<li>有输入输出参数，可以声明变量，有if/else, case,while等控制语句，通过编写存储过程，可以实现复杂的逻辑功能；</li>
<li>函数的普遍特性：模块化，封装，代码复用；</li>
<li>速度快，只有首次执行需经过编译和优化步骤，后续被调用可以直接执行。</li>
</ul>
<p>（3）demo</p>
<p><strong>· 创建一个存储过程</strong></p>
<pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">create procedure user_porced ()
begin
select name from users;
end;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>· 调用存储过程</strong></p>
<pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">call porcedureName ();<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><strong>· 传参存储过程</strong></p>
<pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">create PROCEDURE user_porcedPa(
 in a int(10)
)
 BEGIN
 select * from users where age&gt;a;
 END;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">&gt; call user_porcedPa(10);<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h2 id="数据库备份"><a href="#数据库备份" class="headerlink" title="数据库备份"></a>数据库备份</h2><p><strong>（1）手动方式</strong></p>
<ul>
<li><p><strong>cmd控制台:</strong><br>在环境变量中配置mysql环境变量<br><code>mysqldump –u -账号 –密码 数据库[表名1 表名2..]  &gt; 文件路径</code></p>
<p><strong>案例:</strong> <code>mysqldump -u -root root test &gt; d:\temp.sql</code></p>
</li>
<li><p><strong>如果你希望备份是，数据库的某几张表</strong><br><code> mysqldump -u root -proot test dept &gt; f:\temp.dept.sql</code></p>
</li>
<li><p><strong>如何使用备份文件恢复我们的数据.</strong><br>mysql控制台<br><code> source d:\temp.dept.bak</code></p>
</li>
</ul>
<p><strong>（2）自动方式</strong></p>
<p>把备份数据库的指令，写入到bat文件, 然后通过任务管理器去定时调用 bat文件.</p>
<p>mytask.bat 内容是:</p>
<blockquote>
<p>@echo off</p>
<p>f:\xxx\mysqldump -u root -proot test dept &gt; f:\temp.dept.sql</p>
</blockquote>
<p>创建执行计划任务执行脚本。</p>
<h2 id="数据库范式"><a href="#数据库范式" class="headerlink" title="数据库范式"></a>数据库范式</h2><p>（1）作用：为了建立冗余较小、结构合理的数据库，设计数据库时必须遵循一定的规则。</p>
<p>（2）三大范式</p>
<p>第一范式：1NF是对属性的原子性约束，要求属性(列)具有原子性，不可再分解；(只要是关系型数据库都满足1NF)</p>
<p>第二范式：2NF是对记录的惟一性约束，表中的记录是唯一的, 就满足2NF, 通常我们设计一个主键来实现，主键不能包含业务逻辑。</p>
<p>第三范式：3NF是对字段冗余性的约束，它要求字段没有冗余。 没有冗余的数据库设计可以做到。</p>
<p>还有 BCNF。</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_43079376/article/details/93647335">数据库的第一范式，第二范式，第三范式，BCNF范式理解_sofency’Blog-CSDN博客_数据库第三范式</a></p>
<h2 id="慢查询"><a href="#慢查询" class="headerlink" title="慢查询"></a>慢查询</h2><p>（1）使用show status使用show status查看MySQL服务器状态信息，包括了慢查询的次数</p>
<p>（2）慢查询定义：MySQL默认10秒内没有响应SQL结果,则为慢查询。可以去修改MySQL慢查询默认时间。</p>
<ul>
<li>查询慢查询时间<br><code>show variables like &#39;long_query_time&#39;;</code></li>
<li><ul>
<li>修改慢查询时间<br><code>set long_query_time=1;</code>但是重启mysql之后，long_query_time依然是my.ini中的值</li>
</ul>
</li>
</ul>
<p>（3）在默认情况下，我们的mysql不会记录慢查询，需要在启动mysql时候，指定记录慢查询才可以，将慢查询定位到日志中。</p>
<h2 id="SQL语句执行慢的原因"><a href="#SQL语句执行慢的原因" class="headerlink" title="SQL语句执行慢的原因"></a>SQL语句执行慢的原因</h2><h3 id="偶尔很慢"><a href="#偶尔很慢" class="headerlink" title="偶尔很慢"></a>偶尔很慢</h3><p>（1） 系统在刷新“脏页”中</p>
<p> 当我们要往数据库插入一条数据、或者要更新一条数据的时候，我们知道数据库会在<strong>内存</strong>中把对应字段的数据更新了，但是更新之后，这些更新的字段并不会马上同步持久化到<strong>磁盘</strong>中去，而是把这些更新的记录写入到 redo log 日记中去，等到空闲的时候，在通过 redo log 里的日记把最新的数据同步到<strong>磁盘</strong>中去。当内存数据页跟磁盘数据页内容不一致的时候，我们称这个内存页为“脏页”。</p>
<ul>
<li><p><strong>redolog写满了：</strong>redo log 里的容量是有限的，如果数据库一直很忙，更新又很频繁，这个时候 redo log 很快就会被写满了，这个时候就没办法等到空闲的时候再把数据同步到磁盘的，只能暂停其他操作，全身心来把数据同步到磁盘中去的，而这个时候，<strong>就会导致我们平时正常的SQL语句突然执行的很慢</strong>，所以说，数据库在在同步数据到磁盘的时候，就有可能导致我们的SQL语句执行的很慢了。</p>
</li>
<li><p><strong>内存不够用了:</strong> 如果一次查询较多的数据，恰好碰到所查数据页不在内存中时，需要申请内存，而此时恰好内存不足的时候就需要淘汰一部分内存数据页，如果是干净页，就直接释放，如果恰好是脏页就需要刷脏页。</p>
</li>
</ul>
<p>（2）未获取到锁</p>
<p>  要执行的这条语句，刚好这条语句涉及到的<strong>表</strong>，别人在用，并且加锁了，我们拿不到锁，只能慢慢等待别人释放锁了。或者，表没有加锁，但要使用到的某个一行被加锁了。</p>
<h3 id="一直很慢"><a href="#一直很慢" class="headerlink" title="一直很慢"></a>一直很慢</h3><p>(1) 没有用上索引：例如该字段没有索引；由于对字段进行运算、函数操作导致无法用索引。</p>
<p>(2) 数据库选错了索引。</p>
<h2 id="一条SQL语句的执行过程"><a href="#一条SQL语句的执行过程" class="headerlink" title="一条SQL语句的执行过程"></a>一条SQL语句的执行过程</h2><img src="http://jason-qianhao.xyz/1240-20210630204745577.jpeg" style="zoom:50%;" />

<h2 id="MySQL数据库的高可用"><a href="#MySQL数据库的高可用" class="headerlink" title="MySQL数据库的高可用"></a>MySQL数据库的高可用</h2><p><a target="_blank" rel="noopener" href="https://www.jb51.net/article/83400.htm">MySQL数据库的高可用方案总结</a></p>

                
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/about" rel="external nofollow noreferrer">小小千千</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://jason-qianhao.github.io/2020/10/30/mysql-zhi-shi-hui-zong/">https://jason-qianhao.github.io/2020/10/30/mysql-zhi-shi-hui-zong/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    许可协议。转载请注明来源
                    <a href="/about" target="_blank">小小千千</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/">
                                    <span class="chip bg-color">数据库</span>
                                </a>
                            
                                <a href="/tags/MySQL/">
                                    <span class="chip bg-color">MySQL</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
                <style>
    #reward {
        margin: 40px 0;
        text-align: center;
    }

    #reward .reward-link {
        font-size: 1.4rem;
        line-height: 38px;
    }

    #reward .btn-floating:hover {
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2), 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    #rewardModal {
        width: 320px;
        height: 350px;
    }

    #rewardModal .reward-title {
        margin: 15px auto;
        padding-bottom: 5px;
    }

    #rewardModal .modal-content {
        padding: 10px;
    }

    #rewardModal .close {
        position: absolute;
        right: 15px;
        top: 15px;
        color: rgba(0, 0, 0, 0.5);
        font-size: 1.3rem;
        line-height: 20px;
        cursor: pointer;
    }

    #rewardModal .close:hover {
        color: #ef5350;
        transform: scale(1.3);
        -moz-transform:scale(1.3);
        -webkit-transform:scale(1.3);
        -o-transform:scale(1.3);
    }

    #rewardModal .reward-tabs {
        margin: 0 auto;
        width: 210px;
    }

    .reward-tabs .tabs {
        height: 38px;
        margin: 10px auto;
        padding-left: 0;
    }

    .reward-content ul {
        padding-left: 0 !important;
    }

    .reward-tabs .tabs .tab {
        height: 38px;
        line-height: 38px;
    }

    .reward-tabs .tab a {
        color: #fff;
        background-color: #ccc;
    }

    .reward-tabs .tab a:hover {
        background-color: #ccc;
        color: #fff;
    }

    .reward-tabs .wechat-tab .active {
        color: #fff !important;
        background-color: #22AB38 !important;
    }

    .reward-tabs .alipay-tab .active {
        color: #fff !important;
        background-color: #019FE8 !important;
    }

    .reward-tabs .reward-img {
        width: 210px;
        height: 210px;
    }
</style>

<div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">你的赏识是我前进的动力</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/medias/reward/alipay.jpg" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="/medias/reward/wechat.jpg" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>

            
        </div>
    </div>

    

    

    

    

    
        <style>
    .valine-card {
        margin: 1.5rem auto;
    }

    .valine-card .card-content {
        padding: 20px 20px 5px 20px;
    }

    #vcomments textarea {
        box-sizing: border-box;
        background: url("/medias/comment_bg.png") 100% 100% no-repeat;
    }

    #vcomments p {
        margin: 2px 2px 10px;
        font-size: 1.05rem;
        line-height: 1.78rem;
    }

    #vcomments blockquote p {
        text-indent: 0.2rem;
    }

    #vcomments a {
        padding: 0 2px;
        color: #4cbf30;
        font-weight: 500;
        text-decoration: none;
    }

    #vcomments img {
        max-width: 100%;
        height: auto;
        cursor: pointer;
    }

    #vcomments ol li {
        list-style-type: decimal;
    }

    #vcomments ol,
    ul {
        display: block;
        padding-left: 2em;
        word-spacing: 0.05rem;
    }

    #vcomments ul li,
    ol li {
        display: list-item;
        line-height: 1.8rem;
        font-size: 1rem;
    }

    #vcomments ul li {
        list-style-type: disc;
    }

    #vcomments ul ul li {
        list-style-type: circle;
    }

    #vcomments table, th, td {
        padding: 12px 13px;
        border: 1px solid #dfe2e5;
    }

    #vcomments table, th, td {
        border: 0;
    }

    table tr:nth-child(2n), thead {
        background-color: #fafafa;
    }

    #vcomments table th {
        background-color: #f2f2f2;
        min-width: 80px;
    }

    #vcomments table td {
        min-width: 80px;
    }

    #vcomments h1 {
        font-size: 1.85rem;
        font-weight: bold;
        line-height: 2.2rem;
    }

    #vcomments h2 {
        font-size: 1.65rem;
        font-weight: bold;
        line-height: 1.9rem;
    }

    #vcomments h3 {
        font-size: 1.45rem;
        font-weight: bold;
        line-height: 1.7rem;
    }

    #vcomments h4 {
        font-size: 1.25rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    #vcomments h5 {
        font-size: 1.1rem;
        font-weight: bold;
        line-height: 1.4rem;
    }

    #vcomments h6 {
        font-size: 1rem;
        line-height: 1.3rem;
    }

    #vcomments p {
        font-size: 1rem;
        line-height: 1.5rem;
    }

    #vcomments hr {
        margin: 12px 0;
        border: 0;
        border-top: 1px solid #ccc;
    }

    #vcomments blockquote {
        margin: 15px 0;
        border-left: 5px solid #42b983;
        padding: 1rem 0.8rem 0.3rem 0.8rem;
        color: #666;
        background-color: rgba(66, 185, 131, .1);
    }

    #vcomments pre {
        font-family: monospace, monospace;
        padding: 1.2em;
        margin: .5em 0;
        background: #272822;
        overflow: auto;
        border-radius: 0.3em;
        tab-size: 4;
    }

    #vcomments code {
        font-family: monospace, monospace;
        padding: 1px 3px;
        font-size: 0.92rem;
        color: #e96900;
        background-color: #f8f8f8;
        border-radius: 2px;
    }

    #vcomments pre code {
        font-family: monospace, monospace;
        padding: 0;
        color: #e8eaf6;
        background-color: #272822;
    }

    #vcomments pre[class*="language-"] {
        padding: 1.2em;
        margin: .5em 0;
    }

    #vcomments code[class*="language-"],
    pre[class*="language-"] {
        color: #e8eaf6;
    }

    #vcomments [type="checkbox"]:not(:checked), [type="checkbox"]:checked {
        position: inherit;
        margin-left: -1.3rem;
        margin-right: 0.4rem;
        margin-top: -1px;
        vertical-align: middle;
        left: unset;
        visibility: visible;
    }

    #vcomments b,
    strong {
        font-weight: bold;
    }

    #vcomments dfn {
        font-style: italic;
    }

    #vcomments small {
        font-size: 85%;
    }

    #vcomments cite {
        font-style: normal;
    }

    #vcomments mark {
        background-color: #fcf8e3;
        padding: .2em;
    }

    #vcomments table, th, td {
        padding: 12px 13px;
        border: 1px solid #dfe2e5;
    }

    table tr:nth-child(2n), thead {
        background-color: #fafafa;
    }

    #vcomments table th {
        background-color: #f2f2f2;
        min-width: 80px;
    }

    #vcomments table td {
        min-width: 80px;
    }

    #vcomments [type="checkbox"]:not(:checked), [type="checkbox"]:checked {
        position: inherit;
        margin-left: -1.3rem;
        margin-right: 0.4rem;
        margin-top: -1px;
        vertical-align: middle;
        left: unset;
        visibility: visible;
    }
</style>

<div class="card valine-card" data-aos="fade-up">
    <div class="comment_headling" style="font-size: 20px; font-weight: 700; position: relative; padding-left: 20px; top: 15px; padding-bottom: 5px;">
        <i class="fas fa-comments fa-fw" aria-hidden="true"></i>
        <span>评论</span>
    </div>
    <div id="vcomments" class="card-content" style="display: grid">
    </div>
</div>

<script src="/libs/valine/av-min.js"></script>
<script src="/libs/valine/Valine.min.js"></script>
<script>
    new Valine({
        el: '#vcomments',
        appId: 'Si5PlwXoOsczw9YMDIGjYPSK-gzGzoHsz',
        appKey: 'stI6rxYdK6PXYnmGVxx1JHML',
        notify: '' === 'true',
        verify: 'true' === 'true',
        visitor: 'true' === 'true',
        avatar: 'mm',
        pageSize: '10',
        lang: 'zh-cn',
        placeholder: '在这里评论吧！填写真实邮箱可以获得回复通知哦'
    });
</script>

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/2020/11/02/ji-suan-ji-wang-luo/">
                    <div class="card-image">
                        
                        <img src="http://jason-qianhao.xyz/icfe/3.png" class="responsive-img" alt="计算机网络">
                        
                        <span class="card-title">计算机网络</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2020-11-02
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/%E7%BD%91%E7%BB%9C%E4%B8%8EWeb%E5%AE%89%E5%85%A8/" class="post-category">
                                    网络与Web安全
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/%E7%BD%91%E7%BB%9C%E4%B8%8EWeb%E5%9F%BA%E7%A1%80/">
                        <span class="chip bg-color">网络与Web基础</span>
                    </a>
                    
                    <a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/">
                        <span class="chip bg-color">计算机网络</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2020/10/28/java-chang-jian-wen-ti-hui-zong/">
                    <div class="card-image">
                        
                        <img src="http://jason-qianhao.xyz/banner/47.jpg" class="responsive-img" alt="Java常见问题汇总">
                        
                        <span class="card-title">Java常见问题汇总</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2020-10-28
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/Java/" class="post-category">
                                    Java
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/Java/">
                        <span class="chip bg-color">Java</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>



<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>

<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>


    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card" style="background-color: white;">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h1, h2, h3, h4, h5'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h1, h2, h3, h4, h5').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>




    <footer class="page-footer bg-color">
    
    <div class="container row center-align" style="margin-bottom: 0px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2021-2023</span>
            
            <span id="year">2021</span>
            <a href="/about" target="_blank">小小千千</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            <br>
            
            &nbsp;<i class="fas fa-chart-area"></i>&nbsp;站点总字数:&nbsp;<span
                class="white-color">594.6k</span>&nbsp;字
            
            
            
            
            
            
            <span id="busuanzi_container_site_pv">
                |&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;<span id="busuanzi_value_site_pv"
                    class="white-color"></span>&nbsp;次
            </span>
            
            
            <span id="busuanzi_container_site_uv">
                |&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;<span id="busuanzi_value_site_uv"
                    class="white-color"></span>&nbsp;人
            </span>
            
            <br>
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/Jason-QianHao" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:qianhao_cs@163.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>







    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=404836248" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 404836248" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>







</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <script src="/libs/others/clicklove.js" async="async"></script>
    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

	
    

    

    
    <script type="text/javascript" src="/libs/background/ribbon-dynamic.js" async="async"></script>
    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

</body>

</html>
