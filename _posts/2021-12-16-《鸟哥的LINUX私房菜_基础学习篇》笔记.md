---
title: 《鸟哥的LINUX私房菜_基础学习篇》笔记
tags: 操作系统OS
---

# 《鸟哥的LINUX私房菜_基础学习篇》笔记

# 计算机概论

## 计算机五大单元

主要分为三部分：**输入单元、中央处理器(CPU)、输出单元**

五大单元：输入单元、输出单元、CPU内部的控制单元、算术逻辑单元、内存。

<img src="https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20211216154107969.png" alt="image-20211216154107969" style="zoom:70%;" />

### CPU

#### 种类

​	我们所使用的软件都要经过CPU内部的**微指令集**来完成才行。

​	指令集的设计分为两种设计理念，即两种主要的CPU种类：

- 精简指令集RISC
  - 每个指令执行时间短，性能较佳，但要做复杂的事情需要多个指令完成。
  - 常见CPU公司：Sun的SPARC系列，IBM的Power Architecture系列和**ARM**系列
  - 常见于，学术大型工作站一般使用SPARC；品牌手机、导航系统、网络交换机、路由器等都是**ARM，是目前世界上使用范围最广的CPU**
- 复杂指令集CISC
  - 指令数目多而且复杂，花费时间长，但每个指令可以处理复杂的工作。
  - 常见有AMD、Intel、VIA等x86架构等CPU。x86架构CPU被大量用于个人计算机。
  - **x86名字的由来，是因为最早的那个Intel发展的CPU代号8086，后面又有80286，80386等，所以这种架构的CPU就称为x86架构**。2003年后，Intel的x86架构CPU由8位升级到16、32位，后来**AMD依次架构修改为64位CPU**，为了区别两者，64位的个人计算机CPU统称为X86_64架构。

#### CPU频率

- 概念

  CPU每秒钟可以进行的工作次数。

  >  CPU频率位3.0GHz，表示CPU在一秒内可以进行3.0*10^9次工作，**每次工作可以进行少数的指令运行**。

- 外频与倍频

  CPU与外部各组件速度不一致，很多数据都在CPU内处理，故开发商在CPU内再加上一个加速功能。

  - 外频，CPU与外部组件进行数据传输/运算的速度
  - 倍频，CPU内部用来加速工作性能的一个倍数

  两者相乘才是CPU频率。

  > 上面例子CPU频率3.0GHz，而外频是333MHz，那么倍频就是9倍。

#### 32位与64位

​	总线宽度可以分为32/64bit。总线速度 = 总线传输速度(频率) * 总线宽度。

​	CPU每次能够处理的数据量称为**字组大小**，依据CPU的设计而有32位和64位。**现在所称的计算机是32位或是64位主要是依据CPU解析字组大小而来**。CPU每次能解析的数据量有限，因此内存传来的数据量就有所限制。

​	**字组大小和总线宽度可以不同**。

#### CPU等级

​	1993年左右，x86架构的CPU在intel的Pentium系列后设计不统一，出现i386、i586、i686等名词出现。

- 在Intel Pentium MMX与AMD K6年代的CPU统称为i586等级
- Intel Celeron与AMD Athlon(K7)年代之后的32位CPU称为i686等级
- 目前64位CPU则统称为x86_64等级。

### 内存

​	不论是软件程序还是数据，都必须要读如内存后CPU才能使用。

#### 内存组件

​	个人PC中主要位动态随机访问内存（DRAM）。断电后数据消失，也称为**挥发性内存**。

​	通常内存越大表示系统越快，因为系统不用常常释放一些内存内部的数据。**对服务器而言，内存的容量有时比CPU的速度还重要**。

![image-20211216164842031](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20211216164842031.png)

​	**理论上，CPU与内存的外频应该要相同才好**。

#### 双通道设计

​	传统总线宽度仅为64位，为了加大这个宽度，可以将两个内存汇整在一起，则可以达到128位。数据可以同步写入/读出内存中，提升整体的频宽。

​	开启双通道的内存，容量和型号最好相同！

#### 第二缓存

​	为了某些常用的程序或者数据可以放置到CPU内部而设计，那么CPU数据的读取就不需要通过北桥了。

<img src="https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20211216165422900.png" alt="image-20211216165422900" style="zoom:50%;" />

​	第二缓存(L2 Cache)在CPU内部，故L2内存的速度必须要与CPU频率相同。DRAM无法到达，故使用SRAM。

## 常用计算单位

- 大小单位

  1Byte = 8bit

  ![image-20211216160717997](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20211216160717997.png)

- 速度单位

  - CPU的运算速度常使用MHz或GHz
  - 网络常使用Mbit/s，即每秒多少Mbit

## 接口设备

​	单有CPU也无法运作计算机，需要其他的接口设备才能实际运行。

### 主板

#### 主板芯片组

- 负责将所有的设备连接在一起，让所有的设备能够进行协调与通信。主板上最重要的组件是主板**芯片组**。
- 芯片组通常分为两个桥接器来控制各组件的通信
  - 北桥负责连接速度较快的CPU、内存与显卡等组件。**北桥的总线称为系统总线**，因为是内存传输的主要信道。
  - 南桥负责连接速度较慢的周边接口，包括硬盘、USB、网卡等，**南桥的总线是输入输出总线(IO)**。
- 芯片组负责所有通信，所以也是一个可能会散发出高热量的组件。因此主板上面会发现一些外接的小风扇或者是散热片。

#### IO地址与IRQ中断信道

​	是主板芯片组和其他设备通信的具体通信方式。

- 每个设备都有自己的IO地址。一般不能有两个设备使用同一个IO地址（类比**门牌号**）
- 各设备可以通过IRQ中断通信信道来告知CPU该设备的工作情况，以方便CPU进行工作分配的任务。（类比**各个门牌连接到邮件中心CPU的专门路径。

#### CMOS与BIOS

- CMOS主要**记录主板上面的重要参数**，包括系统时间、CPU电压与频率、各项设备IO地址与IRQ等。**由于记录这些数据需要花费店里，故主板上面才有电池**。
- BIOS位写入到主板闪存或EEPROM的程序，他可以**在开机的时候执行**，以加载CMOS当中的参数，并尝试调用存储设备中的开机程序，进行一步进入操作系统。

### 存储设备

​	存储设备包括：硬盘、软盘、MO、CD、DVD、U盘等。其中最常见的是**硬盘**。

#### 硬盘的物理组成

​	主要由很多的盘片、机械手臂、磁头与主轴马达组成。实际的数据写在具有磁性物质的盘片上。

![image-20211217173130463](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20211217173130463.png)

#### 盘片的数据

![image-20211217173212439](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20211217173212439.png)



- 扇区：由同心圆以放射状的方式分割出磁盘的**最小存储单位**，每个扇区大小**512bytes**，**这个值是固定的**。

- 磁道：扇区组成的一个就是磁道。

- 柱面：在多磁盘上面，同一个磁道可以组成一个柱面，**也是一般分割磁盘时的最小单位**。

#### 传输接口

- IDE接口

- SATA接口

  排线较细小，有利于主机壳内部的散热与安装。

  目前主流的个人计算机硬盘已经被SATA代替了。SATA-2传输速度可达300MB/s。

  ![image-20211217174256889](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20211217174256889.png)

- SCSI接口

  用于工作站等级以上的硬盘传输接口。硬盘的控制器含有一块处理器。

#### 一些参数

- 容量

- 缓冲存储器

  硬盘还有一个缓冲存储器，将硬盘内常用的数据缓存起来。这个缓冲器越大越好。

- 转速

  指主轴马达转动盘片的速度，影响读取数据性能。越高越好。

### 显示设备

- 概念

  显卡又称VGA(Video Graphics Array)。每个图像显示的颜色都会占用内存，所以显卡上面有一个内存容量，它将影响到最终屏幕分辨率和色彩深度。

- GPU

  显卡厂商为了缓解CPU进行3D运算压力，直接在显卡上面嵌入一个3D加速的芯片，即GPU由来。

- 与CPU通信

  通过北桥芯片与CPU、内存通信。

  也是需要告诉运算的组件，所以数据的传输速度越快越好。显卡规格变化：PCI ---》AGP ---》PCI-Express(PCIe)。他们主要区别在数据传输的频宽。

  ![image-20211217172647532](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20211217172647532.png)

  ![image-20211217172702238](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20211217172702238.png)

### 网络设备

### 其他设备

#### PCI(e)适配卡

​	提供多个PCI(e)插槽给用户插入其他功能卡。

## 操作系统

​	提供一个开发软件的操作接口给工程师开发软件，通过接口即可驱动所有的硬件。

​	**操作系统其实也是一组程序**，这组程序的重点在于管理计算机的所有活动以及驱动系统中的所有硬件。

### 内核

​	让CPU开始判断逻辑与运算数值，让内存开始读取数据与程序代码，让硬盘开始被访问等。硬件的所有操作都必须通过操作系统完成。**这就是操作系统内核的功能**。

​	主要在于管控硬件与提供相关的能力，非常重要，因此**内核程序所放置到内存当中的区块是受保护的，并且开机后就一直常驻内存**。

**内核通常包含一些功能**：

- 提供系统调用接口
- 程序管理：CPU调度机制有较加快整体系统性能
- 内存管理
- 文件系统管理
- 设备驱动

### 系统调用

​	<img src="https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20211218164627436.png" alt="image-20211218164627436" style="zoom:50%;" />

​	为了保护内核，并且而让程序员比较容易开发软件，因此操作系统除了内核程序之外，通常还会提供一整组开发接口，那就是**系统调用**。

### 驱动程序

​	操作系统提供一个开发接口给硬件开发商，让他们可以根据这个接口设计可以驱动他们硬件的驱动程序，安装后就可以在操作系统上驱动硬件设备。

<img src="https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20211218170823839.png" alt="image-20211218170823839" style="zoom:50%;" />

# Linux概览

​	提供了一个完整的操作系统当中最底层的硬件控制与资源管理的完整架构，是沿袭Unix良好的传统而来的（UNIX Like 系统），所以**相当稳定并且功能强大，且可以在目前的个人计算机（x86系统）上面跑。**

## 一些历史

- UNIX

  - 1973年，UNIX正式诞生，Ritchie等人以C语言写出第一个正式UNIX内核。
  - 1977年，UNIX的重要分支**BSD（Berkeley Software Distribution, Bill Joy也是Sun的创办者)诞生**。
  - 1984年，x86架构的Minix操作系统诞生。
  - 1984年，Richard Mathew Stallman（史托曼）创建了**GNU项目，目的是创建一个自由、开放的UNIX操作系统（Free UNIX)**。1999年左右，创立**自由软件基金会（Free Software Foundation, FSF)**。1985年左右，为了避免GNU所开发的自由软件被其他人所利用而成为专利软件，与律师草拟了**通用公共许可证（General Public License, GPL）**，称为**CopyLeft（与专利软件的CopyRight相对）**。
  - 1988年，由MIT（麻省理工学院）成立了非营利性性质的**XFree86（X Windows System + Free + x86）**。后面在Linux的GUI发展中有贡献。

- Linux

  - 1991年，芬兰大学生Linus Torvalds，以bash，gcc(GNU C Complie, 一种c语言编译器)等工具写了一个小小的内核程序，且可以在386机器上面运行。
  
  - 期间，为了使LInux程序软件可以兼容UNIX，所以开始**参考POSIX规范修改Linux**。POSIX是可携式操作系统接口（Portable Operating System Interface)缩写，重点在于规范内核与应用程序之间的接口，由IEEE发布的一项标准。UNIX即按照这个规范来设计的。
  
  - 1994年，在广大网友合作下完成Linux的内核正式版Version 1.0。这一版本还有X Window System的支持。1996年完成2.0版本。
  
  - 为了让用户能够接触到Linux，很多的商业公司和团体奖Linux Kernel(含tools)与可运行的软件集成起来，放到光盘或网络给用户安装。这个**”Kernel + softwares + Tools"的可完全安装的系统，称为Linux distribution可完全安装套件**。
  
    distributions主要分为两大系统：
  
    - 使用RPM安装软件的系统，如Red Hat, Fedora, SuSE等。
  
    - 使用Debian等dpkg方式安装软件等系统，如Debian, Ubuntu, B2D等。
## Linux特色

- 配置需求低廉
- 系统稳定
- 保密功能强
- 架构开放，开源，免费或少许费用
- 多任务、多用户

## Linux文件

​	**在Linux系统中，每个设备都被当成一个文件来对待**。常见设备与对应Linux文件名如下：

![image-20211220105319380](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20211220105319380.png)

​	几乎所有的硬件设备文件都在`/dev`这个目录内。

​	系统通过文件的**major与minor**数值识别设备文件。常见硬盘的值如下：

![image-20211229145645115](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20211229145645115.png)

## Linux磁盘分区

### 磁盘分区文件

​	**整块磁盘的第一个扇区特别重要**，记录了整块磁盘的重要信息。主要有两个重要的信息：

- 主引导分区（Master Boot Record， MBR）：可以安装引导加载程序的地方，有446bytes。
- 分区表（partition table）：记录整块磁盘分区的状态，有64bytes。

### 分区表

​	分区的最小单位为**柱面**。分区是以**柱面号码**的方式记录，在分区表的64bytes中，总共分为**四组记录区**，每组及录取记录该区段的**起始与结束的柱面号码**。

​	分区表64bytes最多容纳四个分区，这四个分区被称为**主(Primary)分区**，若主分区被继续划分，则成为**扩展(Extended)分区**。

![image-20211220110119164](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20211220110119164.png)

​	假设硬盘为/dev/hda，则四个区的文件名为如下，其中后面跟的数字，与该分区所在的位置有关。

- P1: /dev/hda1
- P2: /dev/hda2
- P3: /dev/hda3
- P4: /dev/hda4

### 扩展分区

​	Linux一块硬盘想分出不止四个分区，是可以的。**既然第一个分区所在的分区表只能记录四条数据，那可以利用额外的扇区来记录更多的分区信息**。

![image-20211220111330670](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20211220111330670.png)



​	上图P1称为主分区，P2称为扩展分区，L[1-5]由P2继续切分而来称为**逻辑分区(logical partition)**。设备文件名如下。注意没有/dev/hda3和/dev/hda4。因为**前四个号码都是留给Primary或者Extended用的**

- P1: /dev/hda1
- P2: /dev/hda2
- L1: /dev/hda5
- L2: /dev/hda6
- L3: /dev/hda7
- L4: /dev/hda8
- L5: /dev/hda9

​	有几个注意点：

- 扩展分区最多只能有一个
- 能够被格式化后作为数据访问的分区为主分区和逻辑分区，扩展分区无法格式化
- 逻辑分区数量依操作系统不同，在Linux系统中，IDE硬盘最多59个逻辑分区（5-63号），SATA硬盘有11个逻辑分区（5号到15号）

### 建议的磁盘规划

- 简单的分区方法

  仅分出根目录与内存交换空间(/ 和 swap)。

  swap内存交换空间的功能是：当有数据被存放在物理内存里面，但是这些数据又不是常被CPU所取用时，那么这些不常被使用的程序将会被丢到硬盘的swap交换空间中，而将快速的物理内存空间释放出来给真正需要的程序使用。

- 稍微麻烦

  需要较大容量和读写频繁的目录，独立于根目录分区。常见容量大或读写频繁的目录：

  - /
  - /usr
  - /home
  - /var
  - swap

## Linux开机流程

Chapter 20

### 正常开机

1. BIOS，开机主动执行的程序，会识别第一个可开机的设备（硬盘）。
2. MBR，第一个可开机设备的第一个扇区内的主引导分区块，内包含引导加载程序。
3. 引导加载程序（Boot loader），读取内核文件
   - 提供菜单：用户选择不同的开机选项，也是**多重引导**的重要功能。
   - 载入内核文件：直接指向可开机的程序区段来开始操作系统
   - 转交其他loader：将引导加载功能转交给其他loader负责。
4. 内核文件，内核文件工作，开始操作系统的功能。

### 多重引导

其中引导加载程序除了可以安装在MBR之外，还可以安装在每个分区的引导扇区(boot sector)，才有了**多重引导**功能。

![image-20211220134716538](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20211220134716538.png)

​	每个分区都有自己的启动扇区，实际可开机的内核文件是放置在各分区内的。

​	loader只会认识自己的系统分区内的可开机内核文件和其他loader，loader可以直接指向或是间接将管理权转交另一个管理程序。

## Linux文件结构和磁盘挂载

- 文件结构

​	Linux使用**目录树**结构，以根目录（/）为主，然后向下呈现分枝状的目录结构的一种文件结构。

​	如何结合目录树的架构与磁盘内的数据，这个时候就牵扯到“挂载”（mount）问题。

![image-20211222142446218](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20211222142446218.png)

- 磁盘挂载

  利用一个目录当进入点，将磁盘分区的数据放置在该目录下，即**进入该目录就可以读取该分区**。这个操作成为**挂载**，进入点的目录成为**挂载点**。

  如下图，当数据放置在/home内的各个目录时，数据放置在partition2分区；当数据放置在其他目录时，数据放置在partiton1目录。

![image-20211222142819962](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20211222142819962.png)



## Linux启动

​	在Linux默认登录模式中，主要分为两种：

- 纯文本界面（运行等级 run level 3)，可以拥有tty1~tty6的终端界面。
- 图形界面（运行等级 run level 5），拥有tty1~tty7。其中tty7就是开机后等待登录的图形环境。

登录环境的切换：

- [Ctrl] + [Alt] + [F1] ~ [F6]：文字界面登录tty1~tty6终端
- [Ctrl] + [Alt] + [F7]：图形界面桌面

## Linux命令行和简单命令

### 可以输入多条命令

​	使用**分号(;)**隔开多条命令，命令按顺序执行。

### 可以换行输入命令

​	当输入命令太长是时，可以使用`\[Enter]`进行换行输入

### 用户符号区别

- 普通用户

  [xxx@xxx ~]$，其中`~`代表的是用户的主文件夹，即/home/username文件夹

- root

  [xxx@xxx ~]#，命令提示符和普通用户不一样，且~代表/root文件夹

### 执行命令的查询路径PATH

- 概念

  在终端执行命令的时候，其实由一个同名的可执行文件存在。系统会按照PATH的设置去每个PATH定义的目录下查询可执行文件，如果有多个同名的可执行文件，先查到的可执行文件先执行。（当涉及到别名等其他情况时情况会更复杂，详见`Shell-》Bash Shell环境-》路径与命令查找顺序`）

- 查看PATH

  ```shell
  echo $PATH
  ```

  每个目录之间以冒号(:)隔开，有顺序之分。

- 一些事项

  - 不同身份用户默认的PATH不同，默认能够随意执行的命令也不同
  - **使用绝对路径或相对路径直接指定命令的文件名来执行，会比查询PATH来的正确**

### 开关机相关命令

- 将数据同步写入硬盘

  ```shell
  sync
  ```

- 退出登录

  注销Linux，退出登录状态。

  ```shell
  exit
  ```

- 关机

  ```shel
  shutdown
  poweroff
  ```

- 重启

  ```shell
  reboot
  ```

### 基础操作命令

​	在Linux中，不一样的大小写代表不同命令，即**大小写敏感**。

- 显示日期和时间

  ```shell
  data
  ```

- 显示日历

  ```shell
  cal
  ```

- 简单计算器

  ```shell
  bc
  ```

### 重要的热键

- [Tab]

  具有“命令补齐”和“文件补齐”功能。

- [Ctrl] + C

  中断当前程序。但对于比较重要的命令慎用。

- [Ctrl] + D

  代表**键盘输入结束**。也可以代替`exit`命令。

### 查询命令 man

​	man是manual（操作说明）的简写。查询的结果页面称为man page。

- man page存放位置

  一般为`/usr/share/man`，可以修改`/etc/man.config`或`/ect/man.conf`或`/etc/manpath.conf`来改变man page的查询路径。

- 使用方法

```shell
man command
```

<img src="https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20211222153617005.png" alt="image-20211222153617005" style="zoom:80%;" />

- 一些操作

  ![image-20211222154010796](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20211222154010796.png)

- man page简单解析

  - 第一行，命令后面的数字的含义

  ![image-20211222153704567](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20211222153704567.png)

  - 其他参数

    ![image-20211222154050586](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20211222154050586.png)

### 查询命令 info

​	和man类似，但输出格式有所不同。

### 查看Linux内核信息命令

- 查看实际的内核版本

```shell
uname -r
```

- 查看distribution信息

```shell
lsb_release -a
```

### 清除界面显示

```shell
clear
```

# Linux用户管理

## Linux的账号与用户组

### 用户标识符

​	在登录Linux时，是根据ID（UID和GID）来辨认用户，ID和账号的关系存储在**`/etc/passwd`和`/etc/group`**文件中。

​	标识符ID分为两种

- 用户ID，UID
- 用户组ID，GID

### 用户账号

#### 用户登录shell流程

1. 先查`/etc/passwd`文件是否有相关账号
   - 有，查出对应的UID，然后从`/etc/group`文件读出GID
   - 没有，提示没有账号
2. 核对密码表，从`/etc/shadow`找出对应账号信息，对比密码是否正确
3. 如果一切都正确，进入shell

#### `/etc/passwd`文件概览

每一行都代表一个账号。注意，其中有很多系统账号，不能删除！

![image-20220106113429085](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220106113429085.png)

一共被`:`分隔出7个字段

1. 账号名称

2. 密码

   显示`x`，因为对应密码被放到`/etc/shadow`文件了

3. UID

   ![image-20220106113610216](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220106113610216.png)

4. GID

5. 用户信息说明列

6. 主文件夹路径

   默认用户在`/home/username`，root在`/root`

7. Shell

   用户登录的默认shell设置

#### `/etc/shadow`文件概览

每一行都代表一个账号信息

![image-20220106113918319](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220106113918319.png)

一共被`:`分隔出9个字段

1. 账户名称

2. 密码

   密码经过加密了

3. 最近更改密码的日期

   从1970-01-01开始计算的累加日期

4. 密码不可被更改的天数

   相对于第3字段而言的，即为修改密码的间隔时间参数

5. 密码需要修改的天数

   相对于第3字段而言的，即为下一次需要修改密码的时间间隔

6. 密码需要修改期限前的警告天数

   相对第5字段而言的，发出提醒

7. 密码过期后的账号宽限时间

   相对第5字段而言的

8. 账号失效日期

   从1970-01-01开始计算的累加日期计算，表示账号在整个日期之后不能使用

9. 保留字段

   日后新功能加入使用

### 用户组设置

与用户组相关的配置文件在`/etc/group`和`/etc/gshadow`中。

#### `/etc/group`文件概览

每一行代表一个用户组

![image-20220106114733243](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220106114733243.png)

一共被`:`分隔出4个字段

1. 用户组名称

2. 用户组密码

   显示`x`，移动到`/etc/gshadow`文件中

3. GID

4. 此用户组支持的账号名称

#### `/etc/gshadow`文件概览

![image-20220106115855619](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220106115855619.png)

1. 用户组名
2. 密码列
3. 用户组管理员的账号
4. 该用户组的所属账号

#### 有效与初始用户组

- 初始用户组(initial group)

  `/etc/passwd`的GID，是用户登录系统就立刻拥有的用户组。

- 有效用户组(effective group)

  当有多个用户组支持这个用户账号时，若用户新建文件，文件的GID对应的用户组，即为有效用户组

- 用户组信息查看groups

  使用`groups`命令可以查看所以支持这个账号的用户组，且**第一个列出的用户组就是有效用户组**

- 有效用户组切换newgrp

  在已经支持本账号的用户组间切换

  ```shell
  newgrp groupname
  ```

## 账号管理

### 新增与删除用户

#### 新增用户useradd

![image-20220106162339197](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220106162339197.png)

- 默认的一些参数

  使用`useradd -D`查看你默认参数，如group、home目录等等。

  这些数据由**`/etc/default/useradd`**提供

- UID/GID、密码参数等

  来自`/etc/login.defs`文件

  ![image-20220106162911549](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220106162911549.png)

#### 设置密码passwd

![image-20220106163028254](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220106163028254.png)

#### 修改密码参数chage

![image-20220106163238915](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220106163238915.png)

#### 修改账号参数usermod

![image-20220106163342766](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220106163342766.png)

#### 删除用户userdel

![image-20220106163515317](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220106163515317.png)

删除用户的相关数据，主要是：

- 用户账号/密码：`/etc/passwd`、`/etc/shadow`
- 用户组相关参数：`/etc/group`、`/etc/gshadow`
- 用户个人文件数据：`/home/username`、`/var/spool/mainl/username`等等

#### 批量新建用户模板

```shell
#!/bin/bash
# 新建账号，功能包括：
# 1. 检查account1.txt文件是否存在，并将该文件内的账号取出
# 2. 新建上述文件的账号
# 3. 将上述账号的密码修改成强制第一次进入需要修改密码的格式
export PATH=/bin:/sbin:/usr/bin:/user/sbin
if [ ! -f account1.txt ]; then
	echo "所需要的账号文件不存在，请新建account1.txt，每行一个账号名称"
	exit 1
fi
usernames=$(cat account1.txt)
for username in $usernames
do
	useradd $username
	echo $username | passwd --stdin $username
	chage -d 0 $username
done
```

```shell
# account1.txt
std01
std02
std03
```

### 用户其他功能

- 查看用户相关信息

  ![image-20220106164521828](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220106164521828.png)

- 改变用户相关信息

  ![image-20220106164553425](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220106164553425.png)

- 改变用户的shell

  ![image-20220106164613803](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220106164613803.png)

- 查看UID/GID

  ![image-20220106164651382](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220106164651382.png)

### 新增与删除用户组

#### 新增用户组groupadd

![image-20220106164753657](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220106164753657.png)

#### 修改用户组参数groupmod

![image-20220106164836364](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220106164836364.png)

#### 删除用户组

![image-20220106164900521](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220106164900521.png)

删除用户组时，必须确保**`/etc/passwd`内的账号没有任何人使用该用户组作为初始用户组。**

#### 管理用户组

![image-20220106165143996](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220106165143996.png)

## ACL权限

### 概念

​	ACL（Access Control List），主要的目的是提供**`ogu`的`rxw`之外**的具体权限设置。ACL可以针对单一用户、单一文件/目录来进行`rwx`权限的设置。

​	ACL需要文件系统的支持，Centos默认是启动ACL的，若没有启动，可以：

```shell
mount -o remount,acl /
```

​	或者前往`/etc/fstab`文件修改信息如下：

![image-20220106165802144](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220106165802144.png)

### 文件ACL的设置

#### 设置文件ACL

- 使用`setfacl`命令。

![image-20220106165910502](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220106165910502.png)

- acl参数的格式

  `u:用户/用户组:权限`

  若用户字段没有，表示所有者

  ```shell
  setfacl -m u:username:rwx filename
  ```

  设置完后，文件的权限会出现`+`

  ```
  -rwxr-xr--+
  ```

#### 查看文件ACL

- 使用`getfacl`命令

  ```shell
  getfacl filename #参数与setfacl相同，这里省略了
  ```

  ![image-20220106170627549](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220106170627549.png)

  **其中mask是文件的最大范围权限！**

## 用户身份切换

​	在不同用户身份切换，一般是普通用户和root的切换

### su

![image-20220106171040573](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220106171040573.png)

​	**切换root的时候，需要输入root的密码**

- su后不接参数

  表示使用non-login shell的方式登录root，很多原本的变量不会改变，如PATH等。

  ![image-20220106171302965](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220106171302965.png)

- su后接`-`

  代表使用login shell的方式登录root，环境完全变为root环境

- 使用`exit`退出su环境

### sudo

![image-20220106171606965](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220106171606965.png)![image-20220106171614502](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220106171614502.png)

- **切换root的时候，不需要root密码，输入自己的密码即可，且仅有/etc/sudoers的用户才能执行sudo命令**。

- 设置sudo权限使用`visudo`命令。

  ![image-20220106172009357](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220106172009357.png)

## 用户信息传递

### 查询用户在线信息

- `w`/`who`

  查看目前已登录系统的用户

- `last`

  查询近来登陆者信息

- `lastlog`

  读取`/var/log/lastlog`文件，查询每个账号的最近登录时间

### 用户对谈

- write

  给某个用户写消息

  ![image-20220106172732376](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220106172732376.png)

- mesg

  ```shell
  mesg n #拒绝接收消息，但root的消息不可抵挡
  mesg y #接收消息
  ```

- wall

  对所有系统用户广播消息

  ```shell
  wall messagecontent
  ```

### 用户邮箱

​	每个Linux用户都有一个mailbox

​	mailbox在`/var/spool/mail/username`文件

![image-20220106173200918](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220106173200918.png)

# Linux文件系统

## 文件系统与磁盘管理

​	Linux使用Ext2/Ext3作为文件系统。其中EXT2是Linux最传统的磁盘文件系统。

### 文件系统结构

#### 不同的OS使用不同文件系统

​	磁盘分区后，需要进行**格式化**。因为每种操作系统所设置的文件属性/权限并不相同，为了存放这些文件所需的数据，因此需要将分区进行格式化，以成为操作系统能够利用的文件系统格式。Windows并不认识Linux的Ext2文件系统。

- Windows 98，使用FAT或FAT16文件系统
- Windows 2000以后，使用NTFS文件系统
- Linux，使用**Linux second extended file system**(Ext2fs)文件系统

#### 文件系统位置

​	传统磁盘，一个分区只能被格式化为一个文件系统。

​	但由于LVM与软磁盘阵列(software raid)，这些技术可以将一个分区格式化为多个文件系统（例如LVM），也能够将多个分区合成一个文件系统（LVM，RAID）。

​	通常我们可以称呼**一个可被挂载的数据为一个文件系统而不是一个分区**。

#### Ext2底层结构

- Super block：记录文件系统的整体信息，包括inode/block的总量、使用量、剩余量，以及文件系统的格式与相关信息等。
- inode：记录文件的属性，一个文件占用一个inode，同时记录此文件的数据所在的block号码
- block：实际记录文件的内容，若文件太大时，会占用多个block

文件系统先格式化出inode与block的块。系统文件的**属性与权限**数据放置到inode，而inode记录了文件数据的实际放置点的block号码。此时操作系统就据此排列磁盘的阅读顺序。这种方式称为**索引式文件系统**。

![image-20211227141949090](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20211227141949090.png)

​	Ext2文件系统在格式化的时候，区分为多个块组（block group)的，每个块组都有独立的inode/block/superblock系统。**文件系统最前面有一个启动扇区（boot sector)，这个启动扇区可以安装引导装载程序**。

![image-20211227142959039](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20211227142959039.png)

- data block（数据块）

  是用来放置文件内容的地方。在Ext2文件系统中所支持的block大小有1KB，2KB，4KB。在格式化时，block的大小和编号就固定了。不同block大小，对文件系统有些影响：

  ![image-20211227143757121](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20211227143757121.png)

  每个block内最多只能放置一个文件的数据：

  - 如果文件大于block的大小，则一个文件会占用多个block数量
  - 若文件小于block，则该block的剩余空间就不能够再被使用了（磁盘空间会浪费）。

- inodetable(inode表格)

  inode的数量和大小在格式化的时候也被固定，除了用来放文件的属性和权限外，还具有下列特性：

  - 每个inode大小均固定为128bytes
  - 每个文件都仅会占用一个inode而已。**所以文件系统能够创建的文件数量与inode的数量有关**。

  inode记录block号码的区域定义为**12个直接记录区、1个间接记录区、1个双间接记录区、1个三间记录区**。

  ![image-20211227144546633](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20211227144546633.png)

- Superblock（超级块）

  记录整个文件系统相关信息的地方：

  - block与inode的总量
  - 未使用与已使用的inode/block数量
  - block与inode的大小
  - 文件系统的挂载时间、最近一次写入数据的时间、最近一次检验磁盘(fsck)的时间等文件系统的相关信息
  - 一个valid bit数值，若此文件系统已被挂载，则valid bit为0；若未被挂载，则valid bit为1。

  **一般来说，superblock的大小为1024bytes**。一个文件一般应该仅有一个superblock。处理第一个block group含有superblock外，后续的block group不一定含有superblock，若含有则该superblock主要是作为第一个block group内的备份，可以进行superblock的救援。

- File system Description（文件系统描述说明）

  可以描述每个block group的开始与结束的block号码，以及说明每个区段(superblock，bitmap，inodemap, data block)分别介于哪一个block号码之间。

- block bitmap(块对照表)

  从block bitmap中可以知道哪些block是空的，方便新建文件

  删除文件时，在block bitmap中对应的block号码的标志改为“未使用中”。

- inode bitmap(inode对照表)

  与block bitmap类似，只不过是记录inode的信息。

#### U盘底层结构

​	U盘（闪存），使用文件系统一般为FAT格式。FAT没有inode，它将每个block号码都记录在前一个block当中。

![image-20211227142603771](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20211227142603771.png)

#### 与目录树关系

- 目录

  ext2分配一个inode和至少一块block。

  block里面记录在整个目录下的文件名与文件名占用的inode号码。

  **文件系统最顶层的目录的inode一般为2号**。

- 文件

  ext3分配一个inode和多个block记录文件内容。

#### 与内存的交互

​	Linux使用异步处理（asynchronously）来解决读写磁盘慢的问题。

- 当系统文件到内存后，若文件没有被改动过，则内存区段的文件被设置为clean
- 当更改过后，内存中的数据被设置为Dirty。所有的操作都在内存中执行，并没有写入磁盘。系统会不定时将内存中设置为Dirty的数据写会磁盘。也可以使用`sync`强制写入磁盘。

### 文件压缩与打包

#### 文件解压缩技术

- 定义

  由于二进制的0和二进制文件一些重复数据可以进行统计记录的原因，文件空间并不是完全被填满的。

- 压缩比

  压缩前与压缩后的文件所占用的磁盘空间大小的比值

- Linux常见压缩文件后缀

  **compress、gizp、bzip都是对单一文件进行压缩**

  ![image-20211229154418756](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20211229154418756.png)

#### 打包

​	将多个文件后目录包成一个大文件的命令功能。
​	`tar`命令，除了打包外，还支持通过gzip/bzip2进行压缩。

### 完整备份和恢复

​	使用`dump`命令可以对**整个文件系统备份**，也可以对**单个目录备份**。在多次备份中，后一次备份只备份与前一次备份的**有变化的文件**。

![image-20211229160858256](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20211229160858256.png)

​	使用`restore命令可以恢复系统的数据

### 磁盘管理

#### 新增磁盘步骤

1. 对磁盘进行分区，以新建可用的分区
2. 对分区进行格式化，以创建系统可用的文件系统，并进行检验
3. 在Linux上，需要创建挂载点（目录），并进行挂载

#### 设置开机挂载

​	在`/etc/fstab`里面设置挂载相关信息。

![image-20211229150611105](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20211229150611105.png)

​	其中第4列是一些特殊的文件系统参数(mount参数设置也有见)，如下：

![image-20211229151139984](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20211229151139984.png)

​	第5列是指示“能否被dump备份命令使用”

>0：不做dump备份
>
>1：每天进行dump操作
>
>2：不定日期的dump备份操作

​	第6列是“是否以fsck检验扇区”

> 0：不要检验
>
> 1：最早检验

#### 特殊设备挂载

- 镜像文件直接挂载

  ![image-20211229151922645](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20211229151922645.png)

- 创建大文件以制作loop设备文件挂载

  对大文件格式化+挂载

  ```shell
  mkfs -t ext3 /home/loopdev
  
  mount -o loop /home/loopdev /media/cdrom/
  ```

#### 相关配置文件

挂载相关配置文件

- Linux支持的文件系统的驱动

  `/lib/modules/$(uname -r)/kernel/fs/`

- 系统指定的测试（默认）挂载文件系统类型

  `/etc/filesystems`

- 系统已经加载的文件系统类型

  `/proc/filesystems`

- 挂载信息设置`etc/fstab`、`/etc/mtab`和`/proc/mounts`

## 文件属性与权限

​	任何一个文件都具有User、Group和Others 三种等级权限。root可以查看所有文件。

![image-20211223104508097](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20211223104508097.png)

### 文件属性

#### 属性查看

- 使用`ls -al`命令可以查看当前文件下所有的文件详细的属性与权限。

  ![image-20211223104925835](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20211223104925835.png)

- 参数

  ![image-20211223105504819](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20211223105504819.png)

  | 权限       | 连接 | 所有者 | 用户组 | 文件容量 | 修改日期    | 文件名      |
  | ---------- | ---- | ------ | ------ | -------- | ----------- | ----------- |
  | drwx------ | 3    | root   | root   | 4096     | Sep 5 10:37 | .gconf      |
  | -rw-r--r-- | 1    | root   | root   | 42304    | Sep 4 18:26 | install.log |

#### 属性解析

- 第一列，文件类型与权限

  一共10个字符。

  ![image-20211223105515659](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20211223105515659.png)

  第一个字符代表文件是“目录、文件或链接文件等”

  - [d]是目录

  - [-]是文件

  - [l]表示连接文件（linkfile）

    有两种连接文件的方式：

    - hard link（硬连接/实际连接）

      在某个目录下新建一条**文件名连接到某inode号码**的关联记录

      ![image-20211227155701119](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20211227155701119.png)

      有两个限制：不能跨文件系统，不能连接到目录

    - symbolic link（符号连接，即快捷方式）

      创建一个单独的文件，这个文件会让数据的读取指向它连接的那个文件的文件名。

      ![image-20211227160109388](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20211227160109388.png)

  - [b]表示可供存储的接口设备

  - [c]表示串行端口设备，如键盘、鼠标等

  后面9个字符，3个分为一组"rwx"的组合，r为可读，w为可写，x为可执行。如果没有相应权限，用[-]代替。

  - 第一组，**文件所有者的权限**
  - 第二组，**用户组的权限**
  - 第三组，**其他人的权限**

  **特别注意这些权限对于文件和目录的意义**:

  - 对于文件的意义

    特别对于w权限，具有**写入、编辑、新增、修改**文件的内容的权限，但**并不具备删除该文件本身的权限**。

  - 对于目录的意义

    - r权限，表示可以读取目录下的文件名数据

    - w权限，表示具有更改目录结构列表的权限，包括：

      - 新建新的文件和目录
      - 删除文件和目录
      - 重命名文件和目录
      - 转移该目录内的文件、目录位置

    - x权限，表示用户能否进入该目录成为工作目录

      即cd命令能否进入

  **总而言之**：

  > - 让用户能进入某目录成为“可工作目录”的基本权限：
  >
  >   1. 可使用的命令：`cd等切换工作目录命令
  >   2. 目录所需权限：用户对这个目录至少具有`x`权限
  >   3. 额外需求：如果用户想要在这个目录使用`ls`，则还需要`r`权限
  >
  > - 用户在某个目录内读取一个文件的基本权限：
  >
  >   1. 可使用的命令：`cat`、`more`等命令
  >   2. 目录所需权限：用户对这个至少具有`x`权限
  >   3. 文件所需权限：用户对文件至少需要具有`r`的权限才行
  >
  > - 让用户可以修改一个文件的基本权限：
  >
  >   1. 可使用的命令：`nano`、`vim`等编辑器
  >   2. 目录所需权限：用户在该文件所在的目录至少要有x权限
  >   3. 文件所需权限：用户对该文件至少要有`rw`权限
  >
  > - 让一个用户可以创建一个文件的基本权限：
  >
  >   目录所需权限：用户再该目录要具有`wx`权限，特别是`w`权限
  >
  > - 让用户进入某目录并执行该目录下的命令的基本权限：
  >
  >   1. 目录所需权限：用户在该目录至少具有`x`权限
  >   2. 文件所需权限：用户在该文件至少需要有`x`权限

- 第二列，有多少文件名连接到此节点

  每个文件都会将权限与属性记录到文件系统的i-node中。这个属性记录有多少不同的文件名连接到相同的一个i-node号码。

- 第三列，表示文件所有者账号

- 第四列，表示文件的所属用户组

- 第五列，文件容量的大小，默认为**B**

- 第六列，这个文件的创建文件日期或最近的修改日期

  ​	特别注意一下文件的时间，Linux下面会记录许多的时间参数，其中有三个主要的变动时间。**ls默认显示的是mtime**。

  - modification time(mtime)

    文件的“内容数据”（不是文件属性或权限）改变时，更新mtime

  - status time(ctime)

    文件的“状态”（权限或属性被修改等）改变时，更新ctime

  - access time(atime)

    当“文件的内容被读取”（如使用cat命令)时，更新atime

- 第七列，文件名。

  隐藏文件，文件名有个`.`

### 改变文件属性与权限

#### 改变文件所属用户组 chgrp

​	注意，改变后的组名要在`/etc/group`文件中才行。

```shell
chgrp [-R] groupname filename
```

#### 改变文件所有者 chown

​	注意，改变后的用户要在`/etc/password`文件中才行。此外，还可以顺便改变用户组。

```shell
chown [-R] username filenmae

chown [-R] username:groupname filename
```

​	使用环境，如`cp`命令，复制文件时，会同时复制执行者的属性与权限，可能需要改变权限。

#### 改变文件的权限 chmod

​	用来改变文件的权限，有两种方式：数字、符号。

- 数字类型

  使用数字来代替`rwx`。

  - r:4
  - w:2
  - x:1
  - -:0

  每组权限`rwx`的权限数字，是对应的数字相加。如：

  > owner = rwx = 4 + 2 + 1 = 7
  >
  > group = rwx = 4 + 2 + 1 = 7
  >
  > others = --- = 0 + 0 +0

  命令使用方式：

  ```shell
  chmod [-R] xyz filename
  ```

- 符号类型

  使用u, g, o分别代替user 、group、others三种身份，a代表all，即全部身份。

  ![image-20211223112151967](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20211223112151967.png)

  ```shell
  chmod u=rwx, go=rx filename
  
  chmod a+x filename
  ```

### 文件的默认权限

​	在新建文件或目录时候的权限默认值，由umask指定。

​	umask是四个数字，如`0022`，与一般权限有关的后三个数字，分别表示user、group、others需要**在默认权限的基础上拿掉的权限**。比如这里group和others需要去掉`w`权限。

![image-20211224112749847](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20211224112749847.png)

```shell
umask xxx #直接设置ugo需要去掉的权限
```

#### 默认情况的权限

- 若用户创建“文件”，**默认没有可执行`x`权限**，只有`rw`权限，所有最大为666，即默认权限为：

  `-rw-rw-rw-`

- 若用户创建“目录”，默认为777，即

  `drwxrwxrwx`

#### 设置umask后的权限

​	比如若umask为`0022`

- 新建文件时

  `-rw-rw-rw-` - `-----w--w-` = `-rw-r--r--`

- 新建目录时

  `drwxrwxrwx` - `d----w--w-` = `drwxr-xr-x`

### 文件的隐藏属性

#### 设置文件的隐藏属性

![image-20211224113249637](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20211224113249637.png)

#### 显示文件隐藏属性

![image-20211224113314101](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20211224113314101.png)

### 文件特殊权限

​	在Linux的一些特殊文件的权限里，如`/tmp`、`/usr/bin/passwd`等，有`s`、`t`等等权限。

![image-20211224133849294](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20211224133849294.png)

#### SUID

​	`s`出现在文件所有者的`x`权限上时，称为Set UID，简称SUID权限。提供的功能：

- SUID权限仅对**二进制**程序有效
- 执行者对于该程序具有`x`的执行权限
- 本权限仅在执行该程序过程中有效
- 执行者将具有该程序所有者的权限

![image-20211224134144319](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20211224134144319.png)

#### SGID

​	`s`出现在文件用户组的`x`权限上时，称为Set GID，简称SGID权限。如`/usr/bin/locate`文件。

对于**文件**提供的功能：

- SGID对二进制程序有用
- 程序执行者对该程序具有`x`权限
- 执行者在执行过程中获得该程序用户组的支持

对于**目录**提供的功能：

- 用户若对于此目录具有`rx`权限，则该用户能进入目录
- 用户对此目录的有效用户组会变成该目录的用户组
- 若用户再此目录下具有`w`权限，则用户创建的新文件的用户组与此目录的用户组相同

#### SBIT

​	Sticky Bit(SBIT)目前只针对目录有效，作用是：

> 若用户对目录具有`wx`权限，当用户在该目录下创建文件或目录时，仅有自己与root才有权利删除该文件。

#### 特殊权限的设置

​	依然使用`chmod`命令，但需要在之前数字方式的基础上，使用4个数字修改权限，最前面的数字就是代表`SUID`、`SGID`、`SBIT`的权限。

- SUID: 4
- SGID: 2
- SBIT: 1



## Linux目录详解

​	Filesystem Hierarchy Standard(FHS)标准，规定每个特定的Linux目录下应该要放置什么样子的数据。FHS定义出三层目录：

- / ，根目录，与开机系统有关
- /usr , Unix software resource，与软件安装有关
- /var，variable，与系统运作过程有关

### 四种交互作用形态

![image-20211223114038459](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20211223114038459.png)

- 可分享的

  分享给其他系统挂载使用的目录

- 不可分享的

  仅与自身机器有关，不适合分享给其他主机

- 不变的

  有些数据不经常变动，跟随distribution而不变动。如函数库、文件说明文件等。

- 可变动的

  进程改变的数据，如登录文件等。

### 常见目录

#### 根目录(/)的内容

​	FHS建议，根目录所在分区应该越小越好，且应用程序所安装的软件最好不要与根目录放在同一个分区。

​	根目录与开机有关，**开机过程中仅有根目录会被挂载**，其他分区在开机后陆续进行挂载。下面这些目录一定要和根目录放在同一分区下：

- /etc 配置文件
- /bin 重要执行文件
- /dev 需要的设备文件
- /lib 执行文件所需要的函数库与内核所需的模块
- /sbin 重要的系统执行文件

​	根目录下的常见子目录如下：

![image-20211223114837952](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20211223114837952.png)

![image-20211223114851313](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20211223114851313.png)

#### `/usr`的内容

​	是所有系统默认软件的安装目录。/usr的子目录建议有下列：

![image-20211223151450942](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20211223151450942.png)

​	

#### `/var`内容

​	在系统运行之后逐渐填满容量的目录，包括缓存、登录文件、软件运行所产生的文件等。

![image-20211223152046728](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20211223152046728.png)

### 绝对路径和相对路径

- 绝对路径：由根目录(/)开始写起的文件名或目录名称
- 相对路径：相对当前路径的文件名写法。`./xx`，`../xx`，`xx/xx`等
  - `.`代表当前目录
  - `..`代表上一层目录

## Linux文件系统命令

### 目录相关命令

#### 切换目录cd

```shell
cd
```

#### 显示当前目录pwd

```shell
pwd [-P]
```

-P参数显示出当前路径，而非连接路径

#### 新建目录mkdir

```shell
mkdir [-mp] filename
```

- -m 777

  配置文件的权限

- -p filename1/filename2

  递归创建目录

#### 删除一个空的目录rmdir

```shell
rmdir [-p] filename
```

递归删除目录

#### 查看文件与目录ls

![image-20211223171658704](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20211223171658704.png)

![image-20211223171810849](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20211223171810849.png)

​	其中`ls -l`命令有个别名为`ll`。

#### 复制cp

![image-20211223171917441](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20211223171917441.png)

​	特别注意，**在默认的条件中，cp的源文件与目的文件的权限是不同的，目的文件的所有者通常会是命令操作者本身**。

#### 移除rm

![image-20211223172715286](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20211223172715286.png)

#### 移动mv

![image-20211223172939196](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20211223172939196.png)

#### 取路径的文件名basename和目录名称dirname

![image-20211223173744142](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20211223173744142.png)

### 文件内容相关命令

#### 从第一开始显示cat

![image-20211223174226131](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20211223174226131.png)

#### 从最后一行开始显示tac

```shell
tac filename
```

#### 带行号输出nl

![image-20211223174807041](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20211223174807041.png)

#### 一页一页显示more

```shell
more filename
```

可用的操作：

- 空格键，向下翻一页
- Enter，向下滚动一行
- /字符串，向下查询“字符串”关键字
- :f，立刻显示出文件名以及目前显示的行数
- q，立刻离开more，不再显示该文件内容
- b或[Ctrl]+b，往回翻页

#### 可以往前翻页显示less

​	在more的功能基础上，加上往前翻页的功能

```shell
less filename
```

​	可用的操作：

- 空格键，往下翻一页
- [PageDown]，往下翻一页
- [PageUp]，往上翻一页
- /字符串，向下查询“字符串”的功能
- ?字符串，向上查询“字符串”的功能
- n，重复前一个查询（与/或?有关）
- N，反向重复前一个查询（与/或?有关）
- q，离开less这个程序

#### 只看头几行head

![image-20211223180110583](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20211223180110583.png)

#### 只看结尾几行tail

![image-20211223180132401](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20211223180132401.png)

#### 二进制方式读取文件od

![image-20211223180349752](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20211223180349752.png)

#### 修改文件时间或创建新文件touch

![image-20211224104756745](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20211224104756745.png)

#### 查看文件类型file

​	获取文件的基本数据的类型，如ASCII文件、data文件、binary文件，或是有没有动态函数库(share library)等信息。

```shell
file filename
```

### 文件压缩打包命令

#### 解压缩命令

- compress

  ![image-20211229154657937](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20211229154657937.png)

- gzip

  ![image-20211229154921021](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20211229154921021.png)

- ![image-20211229154947217](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20211229154947217.png)

#### 打包命令

![image-20211229160014952](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20211229160014952.png)

常用操作：

- 压缩

  ```shell
  tar -jcv -f tarfilename.tar.bz2 filename
  ```

- 查询

  ```shel
  tar -jtv -f tarfilename.tar.bz2
  ```

- 解压缩

  ```shell
  tar -jxv -f tarfilename.tar.bz2 -C filename
  ```

### 文件/命令的信息查询命令

#### 脚本文件名查询which

​	根据PATH环境变量所规范的路径，去查询完整文件名或命令路径。

![image-20211227121425091](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20211227121425091.png)

#### 按文件名查找相关文件whereis/locate/find

​	这两个命令查询的时候根据**文件数据库**查询，速度会快很多。相对于`find`命令，是直接去磁盘找。

- `whereis`

  ![image-20211227122111403](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20211227122111403.png)

- `locate`

  ![image-20211227122434362](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20211227122434362.png)

  其中`keyword`指的是可以根据`文件部分名称`查找相关的文件。

  - 数据库文件：`/var/lib/mlocate/`
  - 更新数据库：
    - 命令：`updatedb`
    - 配置文件：`/etc/updatedb.conf`

- `find`

  ![image-20211227123151130](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20211227123151130.png)![image-20211227123201007](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20211227123201007.png)![image-20211227123337769](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20211227123337769.png)![image-20211227123420024](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20211227123420024.png)![image-20211227123511169](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20211227123511169.png)

### Linux磁盘命令

#### 查询磁盘每个区段信息dumpe2fs

![image-20211227150331559](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20211227150331559.png)

#### 列出文件系统的整体磁盘使用df

![image-20211227154617262](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20211227154617262.png)

#### 评估文件系统的磁盘使用量du

![image-20211227155016624](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20211227155016624.png)

#### 连接文件ln

![image-20211227160403922](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20211227160403922.png)

#### 磁盘分区fdisk

![image-20211229140604320](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20211229140604320.png)

该命令之后会进入一个交互式环境：

![image-20211229140841468](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20211229140841468.png)

#### 磁盘格式化mkfs/mke2fs

- mkfs

  进行格式化，创建文件系统

  ![image-20211229141501494](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20211229141501494.png)

- mke2fs

  自定义数据创建文件系统

  ![image-20211229141838478](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20211229141838478.png)

#### 磁盘检验fsck/badblocks

- fsck

  检验文件系统是否出错

  执行fsck时，**被检查的分区务必不可挂载到系统上！**

  执行完成后，若系统磁盘有问题会在**挂载点目录**下面创建`lost+found`目录，存放有问题的数据

  ![image-20211229142400667](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20211229142400667.png)

- badblocks

  检查硬盘或软盘扇区有无坏轨

  可以被`mke2fs -c 设备文件名`命令代替，不常用badblocks。

  ![image-20211229143439923](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20211229143439923.png)

#### 磁盘挂载mount

​	挂载是将参数写入`/etc/mtab`和`/proc/mounts`文件

![image-20211229143811728](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20211229143811728.png)

#### 磁盘卸载umount

![image-20211229144827724](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20211229144827724.png)

#### 修改设备文件参数mknod

![image-20211229145806337](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20211229145806337.png)

#### 修改磁盘卷标e2label

![image-20211229150006799](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20211229150006799.png)

#### 更改文件系统类型tune2fs

![image-20211229150104697](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20211229150104697.png)

#### 新建镜像文件mkisofs

![image-20211229161135999](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20211229161135999.png)

#### 光盘刻录cdrecord

![image-20211229161253678](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20211229161253678.png)

# Linux进程管理

Chapter 16、17、18

# Linux系统使用

Chaper 22、23

# Shell

## 程序编辑器

### Vi

​	所以UNIX Like系统都会内置`Vi`文本编辑器，很多软件等编辑接口也都会主动调用`vi`。

#### 模式

​	分为一般模式、编辑模式与命令模式三种。

- 一般模式

  以`vi`命令打开一个文件就直接进入一般模式了。

  可以进行删除、复制、粘贴等操作（**但不会改变文件内容**）

- 编辑模式

  在一般模式，按下`i, I, o, O, a, A, r, R`按键进入，可以编辑文件内容。

- 命令行模式

  在一般模式，输入`:`、`/`、`?`，光标移动到最下面一行，输入相关参数可以进行查找数据等操作。

![image-20220103111542246](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220103111542246.png)

#### 按键说明

- 移动光标

![image-20220103111659552](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220103111659552.png)

![image-20220103112214806](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220103112214806.png)

![image-20220103111753039](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220103111753039.png)

- 一般模式切换编辑模式

  ![image-20220103112427307](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220103112427307.png)

- 一般模式切换到命令行模式

  ![image-20220103112503104](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220103112503104.png)

### Vim

#### 概念

​	`Vim`是`Vi`的高级版本，`Vim`可以使用颜色或底线等方式来显示一些特殊的信息，还支持正则表达式的查找架构、多文件编辑、块复制等。

![image-20220103113750337](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220103113750337.png)

#### 块选择

![image-20220103113153738](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220103113153738.png)

1. 使用`vim`打开文件
2. 使用按键移动光标到预选块左上角
3. 按下`[Ctrl] + V`后将光标移动到预选块右下角
4. 按下`y`进行复制
5. 按下`p`进行粘贴

#### 多文件编辑

![](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220103113454143.png)

#### 多窗口

![image-20220103113619794](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220103113619794.png)

## Shell概念

### 硬件、内核与Shell

​	我们必须通过`shell`将我们输入到命令与内核通信，好让内核可以控制硬件来正确无误的工作。

​	`Shell`的功能只是提供用户操作系统的一个接口，因此`Shell`需要可以调用其他软件。即**只要能操作应用程序等接口都能称为`shell`**.

![image-20220103114029649](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220103114029649.png)

### Linux的Shell

​	在`/etc/shells`文件中定义了可用的`shell`。

- `/bin/sh`，**已经被`/bin/bash`所代替**
- `/bin/bash`，Linux的模式shell，基于GNU架构
- `/bin/ksh`，Kornshell由AT&T Bell lab.发展出来，兼容bash
- `/bin/tcsh`，整合C Sehll，提供更多功能
- `/bin/csh`，已经被/bin/tcsh`所替代
- `/bin/zsh`，基于ksh发展出来，功能更强大的shell

`bash`内置了很多命令，可以利用`type`判断是否是内置命令。

## Shell变量

​	程序、变量与不同用户的关系：

![image-20220103163456519](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220103163456519.png)

**注意，后面命令别名、自定义的变量，如果没有进行保存操作（Bash Shell小节会说），在注销bash后会失效**。

### 变量的显示与设置	

- 显示

  ```shell
  echo ${var}
  ```

- 设置

  ```shell
  var=value
  ```

  注意：

  - 等号两边不能接空格

  - 变量内容有空格，可以使用双引号或单引号

  - **若变量需要在其他子进程执行，需要使用`export`命令**

    子进程仅会继承父进程的环境变量，子进程不会继承父进程的自定义变量

    `export`即是将自定义变量转换为环境变量

  - 通常大小自负为系统默认变量，自行设置变量可以使用小写字符

  - 设置数字变量

    ```shell
    var[index]=content
    #数组名字为var，下标为index，内容为content
    ```

- 取消设置

  ```shell
  unset varname
  ```

### 环境变量

#### `evn`命令查看环境变量

![image-20220105133804168](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220105133804168.png)

#### `set`命令查看所有变量

​	含环境变量与自定义变量

​	`export`即是将自定义变量转换为环境变量

![image-20220105133904835](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220105133904835.png)

### 变量相关操作命令

#### 语系变量locale

- 查看系统支持的所有语系

  ```shell
  locale -a
  ```

- 查看语系相关设置编码

  ```shell
  locale
  ```

  ![image-20220103170213177](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220103170213177.png)

#### 读取键盘输入的变量read

![image-20220103170543499](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220103170543499.png)

#### 声明变量类型declare

![image-20220103171756248](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220103171756248.png)

设置字符串时，默认变量类型为**字符串**。

#### 变量的删除、替换

![image-20220103172941732](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220103172941732.png)

#### 变量的测试与内容替换

![image-20220103173042243](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220103173042243.png)

### 命令别名

- 设置别名

  ```shell
  alias newName=originName
  ```

- 查看别名

  ```shell
  alias
  ```

- 删除别名

  ```shell
  unalias aliasName
  ```

## Bash环境和操作

### 路径与命令查找顺序

​	当同一个命令名对应不同文件时，查找顺序如下：

1. 以相对/绝对路径执行命令
2. 由alias找到该命令执行
3. 由bash内置的命令来执行
4. 通过PATH环境变量的路径找到的一个命令来执行

### 登录和欢迎信息

- 登录提示信息文件

  - `/etc/issue`放置本地登录信息

    这个文件可以使用反斜杠作为变量调用。

    ![image-20220105135332090](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220105135332090.png)

  - `/etc/issue.net`放置远程登录信息

- 欢迎信息

  登录完成后，告诉登录者的信息。在`/etc/motd`文件放置。

### 环境配置文件

bash Shell有两种登录方式

- login shell

  取得bash时需要完整的登录流程的，即为login shell。

  这种方式登录时会读取`/etc/profile`和`~/.bash_profile或~/bash_login或~/.profile`。前者为系统整体设置，后者为用户个人设置。

- non-login shell

  取得bash接口的方法不需要重复登录时，如在图形界面登录后启动终端机，此时终端机的环境即为non-login shell。bash下产生的bash子进程也是这个情况

#### login Shell

![image-20220105141733209](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220105141733209.png)

##### 系统配置文件

​	`/etc/profile`每个用户登录后取得bash时一定要读取的文件。下面是这个文件中主要的几个变量：

- PATH：会依据UID决定PATH变量要不要含有sbin的系统命令目录
- MAIL：依据账号设置好用户的mailbox到`/var/spool/mail/账号名`
- USER：根据用户的账号设置此变量内容
- HOSTNAME：依据主机的hostname命令决定此变量内容
- HISTSIZE：历史命令记录条数

此外，文件中还会调用其他的配置文件。

##### 个人配置文件

​	在读取`/etc/profile`后会继续读取个人配置文件。3个个人配置文件**只会读取其中一个**，读取顺序是：

1. `~/.bash_profile`
2. `~/.bash_login`
3. `~/.profile`

其中`~/.bash_profile`中主要逻辑是判断`~/.bashrc`文件是否存在，存在就读取。

#### non-login Shell

​	该方式登录bash仅会读取`~/.bashrc`而已。

![image-20220105143606285](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220105143606285.png)

#### 读取环境配置文件

​	修改上述配置文件后，通常需要注销和重新登录后生效。但是使用`source`命令可以直接生效而不用重启.

```shel
source filename
. filename
```

### 通配符和特殊符号

- 通配符

  ![image-20220105144730322](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220105144730322.png)

- 特殊符号

  ![image-20220105144744963](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220105144744963.png)

### 数据流重定向

#### 概念

​	命令执行的时候需要输入，执行完后需要将数据输出。具体从哪输入和输出到哪则可以进行设置。

- 标准输入（standard input, stdin)：代码为0，使用<或<<
- 标准输出（standard output, stdout)：代码为1，使用>或>>
- 标准错误输出（standard error output，stderr)：代码为2，使用2>或2>>

#### 数据流输出

- 不同符号的意义

  - 1>：以覆盖的方法将正确的数据输出到指定的文件或设备上
  - 1>>：以累计的方法将正确的数据输出到指定的文件或设备上
  - 2>：以覆盖的方法将错误的数据输出到指定的文件或设备上
  - 2>>：以累计的方法将错误的数据输出到指定的文件或设备上

- 常见用法

  ```shell
  command > filename1 2> filename2 # 正确和错误数据分别输出到两个文件
  
  command > filename 2>&1 # 正确和错误数据分别输出到同一个文件
  ```

- `/dev/null`垃圾桶

  这个黑洞设备可以吃掉任何导向这个设备的信息，即输入这里的信息将被丢弃。

#### 数据流输入

​	stdin即是将原本需要由键盘输入的数据改由文件内容来代替

- `<`

  ```shell
  cat > outfilename < inputfilename
  ```

  ![image-20220105150517867](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220105150517867.png)

- <<

  代表输入结束的意思。

  ![image-20220105150546420](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220105150546420.png)

### 多个命令执行的判断条件

#### 命令回传码$?

​	若一个命令执行的结果为正确，在Linux下面会回传一个**`$?=0`**

#### 判断条件

![image-20220105151003619](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220105151003619.png)

​	若有多个判断条件，Linux**从左到右**开始进行判断

### 管道命令

​	符号是`|`，将多个命令连接起来进行处理

![image-20220105151436691](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220105151436691.png)

管道命令在使用时，**每个管道后面的第一个数据一定是“命令”，且这个命令必须要能够接收数据**。

管道命令的注意点：

- 管道命令仅处理**stdout，忽略stderr**
- 管道命令必须接收前一个命令的数据成为stdin来继续处理

注意减号`-`的用途，**在某些命令用到文件名的时候，stdin和stdout可以用`-`来代替**。

#### 选取命令

- cut

  按自定义方式分割字符串并选取片段

  ![image-20220105151821196](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220105151821196.png)

- grep

  查找输入相关的字符串

  ![image-20220105151953296](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220105151953296.png)![image-20220105152001216](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220105152001216.png)

  ![image-20220105160248886](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220105160248886.png)

#### 排序命令

- sort

  ![image-20220105152100436](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220105152100436.png)

- uniq

  对输出结果去重处理

  ![image-20220105152156981](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220105152156981.png)

- wc

  统计字符

  ![image-20220105152440567](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220105152440567.png)

#### 双向重定向

​	同时将数据流送到文件与屏幕

![image-20220105152614042](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220105152614042.png)

#### 字符串转换

- tr

  删除一段信息当中的文字，或是进行文字信息的替换。

  后面的字符串可以是**正则表达式**

  ![image-20220105152749247](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220105152749247.png)![](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220105152803495.png)

- col

  ![image-20220105153105945](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220105153105945.png)

- join

  对比两个文件的数据相关性，并将两个文件当中有相同数据的行相加在一起

  ![image-20220105153216104](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220105153216104.png)

- paste

  直接将两个文件的两行贴在一起

  ![image-20220105153540224](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220105153540224.png)

- expand

  将[tab]转换为空格键

  [tab]默认为8个空格

  ![image-20220105153703697](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220105153703697.png)

#### 切割命令

​	将一个大文件依据文件大小或行数来切割为小文件

![image-20220105153901791](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220105153901791.png)

#### 参数代换

​	xargs读入stdin的数据，并以空格或断行字符进行分隔为名的参数

![image-20220105154026640](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220105154026640.png)

## 正则表达式

​	正则表达式(Regular Expression)是通过一些特殊字符的排列，用以查找、替换、删除一行或多行文字字符串。

### 基础正则

#### 语系的设置

​	不同语系对正则的结果有影响，通常使用C语系即`LANG=C`，兼容POSIX的标准。其有些特殊的符号如下。

![image-20220105160112857](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220105160112857.png)

#### 基础正则字符表

![image-20220105160416217](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220105160416217.png)![image-20220105160426010](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220105160426010.png)

### 扩展正则

![image-20220105160844165](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220105160844165.png)

### 相关工具

#### 数据CURD工具`sed`

![image-20220105160754008](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220105160754008.png)![image-20220105160800618](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220105160800618.png)

#### 输出格式化工具

- printf

  ![image-20220105161017356](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220105161017356.png)

- awk

  ```shell
  awk '条件类型1{动作1} 条件类型2{动作2} ...' filename
  ```

  ![image-20220105161841639](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220105161841639.png)

  - 相比于sed常常处理整行数据，awk可以分段处理，非常适合处理小型的数据处理。

  - awk可以后接文件处理，也可以处理前一个命令的stdout.

  - 处理的每一行的字段内的数据，默认以空格键或[tab]键进行分隔。

  - 每一行的字段都有变量名`$colum`，colum是第几列，其中`$0`表示整行。
  - awk的内置参数：

  ![image-20220105162023997](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220105162023997.png)

  - awk的条件逻辑运算符

  ![image-20220105162144128](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220105162144128.png)

  - 在awk中，shell变量可以直接使用，不用加上$符号

## Shell Script

### 概念

​	shell script 是利用shell的功能所写的一个“程序”，这个程序是使用纯文本文件，将一些shell的语法与命令（含外部命令）写在里面，搭配正则表达式、管道命令与数据流重定向等功能，以达到我们所想要的处理目的。

​	shell script是直接利用shell与相关工具，所以不需要编辑即可执行。

### 基本语法

#### 基本知识

1. 命令的执行是从上而下，从左而右地分析与执行
2. 空白行会被忽略掉，并且[tab]键所得到的空白同样是为空格键
3. 读取到一个Enter符号（CR），就尝试开始执行改行命令
4. 一行内容太多，可以使用`\[Enter]`换行
5. `#`视为批注

#### 执行命令的方法

​	执行sh文件必须具备可读与可执行(`rx`)权限！

​	分为执行命令的方式有两大种，其中第一种又分3种。

- 使用bash

  ```Shell
  bash shell.sh
  或
  sh shell.sh
  ```

  - 绝对路径执行
  - 相对路径执行
  - 放置到PATH或其已经写入的目录下，直接输入sh文件名执行

  **这种方式执行，script会使用一个新的`bash`环境来执行命令，即script是在bash的子进程执行的。所以在script中设置的变量不会传回到父进程中。**

  ![image-20220105165748382](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220105165748382.png)

- 利用source或`.`

  ```shell
  source shell.sh
  ```

  **这种方式执行，script直接在父进程中执行，所以script中定义的变量会生效**。

  ![image-20220105165853548](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220105165853548.png)

#### sh文件分析

![image-20220105164206712](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220105164206712.png)

- 第一部分，声明，说明这个script使用的shell名称

  bash在执行的时候会加载相关的配置文件，一般是non-login shell的`~/.bashrc`。

- 第二部分，批注，程序内容的说明

- 第三部分，主要环境变量的说明

  一般来说声明PATH和LANG，以使用外部命令

- 第4部分，主要程序部分

- 第5部分，告知执行结果

  `exit n表示中断程序并回传一个值个系统。后面的命令使用`$?`即可得到这个值。

#### sh的默认变量

- 使用特殊符号，读取sh文件后接的输入参数。

  ​	按整条命令的参数顺序，依次为`$0`、`$1`等（从bash/sh的下一个参数开始）

  ![image-20220106105950275](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220106105950275.png)

- 一些特殊符号：
  - `$#`，表示sh文件后面接的参数的个数
  - `$@`，表示sh文件的所有参数
  - `$*`，表示`$0c$1c$2`，其中c为分隔符，默认为空格键

- `shift`，造成参数变量号码偏移

### 逻辑语法

#### 条件判断

**两个可以写在条件里面的判断式**:

- 测试命令Test

  检测某个文件是否存在、是否有特定属性权限、基本大小判断等等。![image-20220106104417160](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220106104417160.png)![image-20220106104450709](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220106104450709.png)

- 判读符号[]

  返回结果只有真和假，可以结合`&&`和`||`使用

  ![image-20220106105056317](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220106105056317.png)

  **一些注意事项：**

  - 中括号的两端需要有空格符来分割
  - 中括号内的每个组件都需要有空格键来分隔
  - 中括号内的变量，最好都以双引号括起来
  - 中括号内的常量，最好都以单或双引号括起来

  **一些参数：**

  - `-o`参数，在中括号里面相当于“或”

**下面就是具体的条件表达式**:

- `if...then`

  ![image-20220106110644574](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220106110644574.png)

  ![image-20220106110719404](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220106110719404.png)

- `case..esac`

  ![image-20220106110834908](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220106110834908.png)

  一个列子：

  ![image-20220106110856307](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220106110856307.png)

#### 循环

*不定循环*：

- `while do done`

  ![image-20220106111728580](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220106111728580.png)

- `until do done`

  ![image-20220106111744960](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220106111744960.png)

*固定循环*：

- `for...do...done`

  ![image-20220106111858866](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220106111858866.png)

  ![image-20220106111937902](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220106111937902.png)

### 函数

- 语法

  ![image-20220106111103302](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220106111103302.png)

  由于shell script的执行方式是由上而下、由左而右，所以**function的设置一定要在程序的最前面**。

- 内置参数

  函数名称用`$0`表示，后续节点变量依次用`$1`、`$2`等表示。

  后面接参数的形式是：

  ```shell
  fname opt1 opt2 opt3 ...
  ```

### shell script的追踪与调试

![image-20220106112036406](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220106112036406.png)

## Shell其他相关命令

### Shell资源限制命令ulimit

![image-20220103172454549](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220103172454549.png)

### 查看历史输入命令history

![image-20220105133021865](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220105133021865.png)

- 历史命令记录在`~/.bash_history`文件中
- `~/.bash_history`记录的命令个数和bash的`HISTSIZE`变量有关。

### 设置终端机环境stty/set

- 设置按键代表的含义等

![image-20220105144130419](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220105144130419.png)

```shell
stty function Key
#例如： stty erase ^h，^代表[Ctrl]
```

- 设置Bash的终端机环境

![image-20220105144453394](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220105144453394.png)

### 文件比较命令diff/cmp/patch

- diff

  以行为单位进行文件比较

  ![image-20220105162630991](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220105162630991.png)

- cmp

  利用字节为单位进行比较，可以比较二进制文件

  ![image-20220105162745735](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220105162745735.png)

- patch

  ![image-20220105162854512](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220105162854512.png)

