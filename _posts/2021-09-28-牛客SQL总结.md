---
title: 牛客SQL总结
tags：MySQL
---

# 牛客SQL总结

# 建表

## SQL36

<img src="/../assets/NK-SQL/image-20210929111953766.png" alt="image-20210929111953766" style="zoom:50%;" />

```sql
create table actor_name
(
first_name varchar(45) not null,
last_name varchar(45) not null
) as 
select first_name,last_name
from actor
```

## SQL39

<img src="/../assets/NK-SQL/image-20210929112125985.png" alt="image-20210929112125985" style="zoom:50%;" />

```sql
select *
from salaries
force index (idx_emp_no)
where emp_no=10005
```

## SQL40

<img src="/../assets/NK-SQL/image-20210929112210893.png" alt="image-20210929112210893" style="zoom:50%;" />

```sql
ALTER TABLE actor ADD create_date datetime NOT NULL DEFAULT '2020-10-01 00:00:00'
```

## SQL41（触发器）

<img src="/../assets/NK-SQL/image-20211008125722460.png" alt="image-20211008125722460" style="zoom:50%;" />

```sql
create trigger audit_log 
after insert on employees_test
for each row
begin 
    insert into audit values(new.id,new.name);
end
```

## SQL46

<img src="/../assets/NK-SQL/image-20211008145453608.png" alt="image-20211008145453608" style="zoom:50%;" />

```sql
ALTER TABLE audit
ADD CONSTRAINT FOREIGN KEY (emp_no)
REFERENCES employees_test(id);
```



# 查询

## 最值

### SQL2

<img src="//../assets/NK-SQL/image-20210928160517266.png" alt="image-20210928160517266" style="zoom:50%;" />

```sql
select 
	* 
from 
	employees 
order by 
	hire_date desc 
limit 2, 1;
```

主页limit第一参数为(页数 - 1)

## 去重

### SQL8

<img src="//../assets/NK-SQL/image-20210928161305190.png" alt="image-20210928161305190" style="zoom:50%;" />

```sql
SELECT
    DISTINCT salary
FROM
    salaries
ORDER BY
    salary desc
```

## 多表查询

### SQL10

<img src="//../assets/NK-SQL/image-20210928161526148.png" alt="image-20210928161526148" style="zoom:50%;" />

```sql
SELECT
    employees.emp_no
FROM
    employees
left JOIN
    dept_manager
ON
    dept_manager.emp_no = employees.emp_no
WHERE
    dept_manager.emp_no is null
```

### SQL11

<img src="//../assets/NK-SQL/image-20210928161633124.png" alt="image-20210928161633124" style="zoom:50%;" />

```sql
SELECT
    e.emp_no,
    m.emp_no as manager
FROM
    dept_emp e
JOIN
    dept_manager m
on
    e.dept_no = m.dept_no
WHERE
    e.emp_no != m.emp_no
group BY
    e.dept_no
```

### SQL12

<img src="//../assets/NK-SQL/image-20210928161812571.png" alt="image-20210928161812571" style="zoom:50%;" />

```sql
select 
    t.dept_no, 
    s.emp_no, 
    t.maxSalary
from 
    (
    select
        d.dept_no, 
        max(s.salary) as maxSalary 
    from 
        dept_emp d,
        salaries s
    where 
        d.emp_no = s.emp_no 
    group by 
        d.dept_no
    ) as t, 
    salaries s, 
    dept_emp d
where 
    t.maxSalary = s.salary and 
    t.dept_no = d.dept_no and 
    d.emp_no = s.emp_no
order by 
    t.dept_no asc
```

### SQL19

<img src="//../assets/NK-SQL/image-20210928162304345.png" alt="image-20210928162304345" style="zoom:50%;" />

```sql
SELECT
    e.last_name,
    e.first_name,
    d.dept_name
FROM
    employees e
LEFT JOIN
    dept_emp de
ON
    e.emp_no = de.emp_no
LEFT JOIN
    departments d
ON
    de.dept_no = d.dept_no
```

### SQL21

<img src="/../assets/NK-SQL/image-20210929105618744.png" alt="image-20210929105618744" style="zoom:50%;" />

```sql
-- 本题应该考虑降薪的问题:题中没有讲员工不降薪，所以不能直接使用最大薪水-最小薪水求值
SELECT 
  s1.emp_no,
  s2.salary - s1.salary AS growth 
FROM
  (SELECT 
    e.emp_no,
    s.salary 
  FROM
    employees e 
  LEFT JOIN salaries s 
      ON e.emp_no = s.emp_no 
  		WHERE e.hire_date = s.from_date) AS s1  -- 入职薪水
  INNER JOIN 
    (SELECT 
      e.emp_no,
      s.salary 
    FROM
      employees e 
    LEFT JOIN salaries s 
        ON e.emp_no = s.emp_no 
    		WHERE s.to_date = '9999-01-01'
    ) AS s2  -- 现在薪水
    ON s1.emp_no = s2.emp_no  
ORDER BY growth 
```

### SQL22

<img src="/../assets/NK-SQL/image-20210929105949261.png" alt="image-20210929105949261" style="zoom:50%;" />

```sql
SELECT
    d.dept_no,
    d.dept_name,
    t.sum
FROM
    (
     SELECT
        de.dept_no,
        COUNT(*) as "sum"
     FROM
        dept_emp de
     JOIN
        salaries s
     ON
        de.emp_no = s.emp_no
     GROUP BY
        de.dept_no
    ) as t
JOIN
    departments d
ON
    d.dept_no = t.dept_no
```

### SQL25

<img src="/../assets/NK-SQL/image-20210929110544985.png" alt="image-20210929110544985" style="zoom:50%;" />

```sql
SELECT
    de.emp_no,
    t.manager_no,
    s.salary as emp_salary,
    t.manager_salary
from
    dept_emp de
JOIN
    (
    SELECT
        dm.emp_no as manager_no,
        dm.dept_no,
        s.salary as manager_salary
    FROM
        dept_manager dm
    JOIN
        salaries s
    ON
        dm.emp_no = s.emp_no
    ) as t
ON
    t. dept_no = de.dept_no
JOIN
    salaries s
ON
    de.emp_no = s.emp_no
WHERE
    s.salary > t.manager_salary
```



## 排名序号

### SQL23

<img src="/../assets/NK-SQL/image-20210929110105165.png" alt="image-20210929110105165" style="zoom:50%;" />

```sql
SELECT
    s1.emp_no,
    s1.salary,
    COUNT(DISTINCT s2.salary) as t_rank
FROM
    salaries s1
JOIN
    salaries s2
		ON
    	s1.salary <= s2.salary
GROUP BY
    s1.emp_no
ORDER BY
    t_rank
```

## 函数

### 聚合函数

#### SQL16

<img src="//../assets/NK-SQL/image-20210928162059085.png" alt="image-20210928162059085" style="zoom:50%;" />

```sql
SELECT
    t.title,
    avg(s.salary)
FROM
    titles t
JOIN
    salaries s
ON
    t.emp_no = s.emp_no
GROUP BY
    t.title
ORDER BY
    avg(s.salary)
```

### 系统函数

#### SQL32

<img src="/../assets/NK-SQL/image-20210929111619847.png" alt="image-20210929111619847" style="zoom:50%;" />

```sql
SELECT
    CONCAT(last_name, ' ', first_name)
from
    employees
```

# 插入

## SQL34

<img src="/../assets/NK-SQL/image-20210929111755733.png" alt="image-20210929111755733" style="zoom:50%;" />

```sql
INSERT INTO actor(actor_id,
                  first_name,
                  last_name,
                  last_update)
VALUES(1,'PENELOPE','GUINESS','2006-02-15 12:34:33'),
      (2,'NICK','WAHLBERG','2006-02-15 12:34:33');
```

## SQL35

<img src="/../assets/NK-SQL/image-20210929111844515.png" alt="image-20210929111844515" style="zoom:50%;" />

```sql
# mysql中常用的三种插入数据的语句:
# insert into表示插入数据，数据库会检查主键，如果出现重复会报错；
# replace into表示插入替换数据，需求表中有PrimaryKey，
#             或者unique索引，如果数据库已经存在数据，则用新数据替换，如果没有数据效果则和insert into一样；
# insert ignore表示，如果中已经存在相同的记录，则忽略当前新数据；
insert ignore into actor values("3","ED","CHASE","2006-02-15 12:34:33");
```

# 删除

## SQL42

<img src="/../assets/NK-SQL/image-20211008143658302.png" alt="image-20211008143658302" style="zoom:50%;" />

```sql
DELETE
    t2.*
FROM
    `titles_test` t1,
    `titles_test` t2
WHERE
    t1.emp_no = t2.emp_no and
    t1.id < t2.id
```

# 更新

## SQL48

<img src="/../assets/NK-SQL/image-20211008145613875.png" alt="image-20211008145613875" style="zoom:50%;" />

```sql
UPDATE
    salaries
SET
    salary = salary + salary * 0.1
WHERE
    emp_no in (
        select
            emp_no
        from
            emp_bonus
    ) and
    to_date = '9999-01-01'
```

