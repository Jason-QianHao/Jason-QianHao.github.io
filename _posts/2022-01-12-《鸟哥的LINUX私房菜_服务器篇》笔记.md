---
title: 《鸟哥的LINUX私房菜_服务器篇》笔记
tags: 操作系统OS
---

# 《鸟哥的LINUX私房菜_服务器篇》笔记

# 基础网络概念

## 计算机联网结构

本书的局域网结构

![image-20220113160210457](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220113160210457.png)

- 网络接口

  利用软件设计的网络接口，主要是提供网络地址IP

  **一张网卡至少可以搭配多个网络接口**

  每部主机内部也有一个内部接口，**loopback（lo）**循环测试接口。

- 网络形态或拓扑结构

  各个节点在网络上的链接方式，一般指物理方式。

  上图则为星形拓扑结构。

- 网关（route/gateway)

  具有两个以上的网络接口，可以连接两个以上不同的网段的设备。
  
- IP分享器

  具有网关、防火墙、DHCP等功能的设备。

## TCP/IP的数据链路层

主要是以太网的相关概念

- 局域网网络结构

  <img src="https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220112164600244.png" alt="image-20220112164600244" style="zoom:80%;" />

  以太网的传输主要是**网络卡对网络卡**之间的数据传递

  每个主机都是联机到集线器(hub/switch)，然后通过集线器向所有主机发起联机

  每个以太网网卡出厂时，赋予一个独一无二的MAC卡号，一般不能被修改

  使用CSMA/CD协议进行通讯

- 可以使用MAC通讯

  ![image-20220112165013271](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220112165013271.png)

  MAC不能跨局域网通信！

## TCP/IP的网络层

关于IP相关参数可以做如下假设，来理解：

> 在某一街道的所有用户作为主机，门牌号想象为IP
>
> - 网域：只要在这条街上都是一个网域
> - Network IP：这个街道的第一个门牌，代表整个街道，整个网域
> - Broadcast IP：街道的最后一个门牌
> - 路由器：这个街道的邮局，要想发送数据给其他街道的用户，只需要把数据给邮局进行转发即可

主机连上Internet的必须参数如下：

![image-20220112175213706](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220112175213706.png)

### 一些概念

#### 网段与网域

- 物理网段

  当所有的主机都使用同一个网络媒体串在一起，这个时候这些主机在实体装置上其实是联机在一起的，那么就可以称为在同一个物理网段。

  同一个物理网段，主机可以直接通过MAC通信，也可以通过广播进行网络联机

- 网域

  IP地址的网络号相同，主机号不同

- IP网段

  同一个物理网段内，可以依据不同的IP设定，设置为多个IP网段

#### Network与Broadcast

- 全0的主机号，表示整个网段的地址(Network IP)

  网域的第一个IP

- 全1的主机号，表示广播地址（Broadcast IP）

  网域的最后一个IP

  广播地址不同的两个主机的通信，需要使用路由器(router)

#### loopback IP

作为内部循环测试的网络接口，没有网卡也可以使用。

一般为127.0.0.0/8，是个Class A。

#### Netmask

子网掩码，网络号全1，主机号全0。

划分子网的作用，标识网络号的位置。

#### CIDR

无等级网域间路由，在IP后标出网络号的位数

`IP/net number`，如`192.168.0.0/24`

**通常表示一个网段会使用`NetWork/Netmask`的方式**，由此就可以算出Broadcast和可用IP。

### IP分级

![image-20220112171210942](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220112171210942.png)![image-20220112171219612](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220112171219612.png)

### IP分类

- Public IP

  公共IP，有这个IP才能连上Internet

- Private IP

  不能直接连上Internet的IP，主要用于局域网的主机联机

  ![image-20220112171648445](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220112171648445.png)

  在私有IP后加上NAT服务即可连上Internet

### 路由（网关相关）

- 两个主机在两个网段时，不能直接IP广播通信，只能借助路由器

![image-20220112173211096](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220112173211096.png)

- 在主机查询路由表时，没有符合的路由，就会把IP包送去预设路由器（**默认网关，default gatway，大部分为广播地址，具体需要问管理员**）

- 观察主机路由`route`命令

  ![image-20220112173649795](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220112173649795.png)

  输出一共有8个字段，按顺序是：

  - Destination

    就是Network。

    字段为default时，表示当要去的网域不在其他Destination列表内时，通过default这行的gateway转发出去。

  - Gateway

    该网络接口的gateway的IP

    若为0.0.0.0即为不需要额外的IP

  - Genmask

    就是Netmask

  - Flags

    U：代表路由可用

    G：代表网域需要经过Gateway准发

    H：代表该路由为一部主机，而非整个网域

  - Metric

  - Ref

  - Use

  - Iface

    Interface（网络接口），表示要去本机要去这个Destination需要走的网络接口

# Linux连接Internet

chapter 6

## 局域网常见布线规划

局域网（Local Area Network， LAN)的Linux服务器的布线方式有多种，这些方式有下面几个前提条件：

- 较小空间局域网，如一个办公室
- 以一个switch为中心的星形联机架构

- 假设仅有一条ADSL线对外联机的情况下

### Linux直接联网-与PC同地位

此时如果ADSL是多IP的（可以拨接2-8个IP）的情况，可以使用这个模式。

![image-20220113153802132](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220113153802132.png)

每个节点可以直接通过私有IP进行联机

每个节点可以自行通过ADSL拨接连接Internet

局限性：

- 每个节点相对独立，不好管理
- 这是一个没有防火墙的环境！
- 内外部网络没有明确的分开

### Linux直接联网-与一般PC分开网域

如果有多个Public IP，可以将Linux和其他节点的网域分开。

![image-20220113154314575](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220113154314575.png)

LAN的每个节点可以直接通过私有IP进行联机

LAN的每个节点必须通过IP分享器（一个类似网关的设备）连接到Internet，IP分享器也可以设置一些简单的防火墙规则。

LAN内的节点方便维护

### Linux直接联网-让Linux直接管理LAN

没有IP分享器的时候，可以让Linux充当。此时**Linux必须具备两张网卡，一个对外，一个对内**。

![image-20220113155125601](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220113155125601.png)

Linux可以作为内网对外的防火墙使用。

维护内网简单，但是Linux一旦挂点，整个内网就不能对外联机。

**比较推荐！**

### Linux放在防火墙后-让Linux使用Private IP

依然使用IP分享器充当防火墙的角色

![image-20220113155531262](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220113155531262.png)

## 连接

### 网络卡

网络卡的装置有自己的代号，默认的网卡是eth0，第二张网络卡为eth1，依次类推。

#### 网卡硬件信息查看dmesg

```shell
dmesg | grep -in eth
```

![image-20220113161442057](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220113161442057.png)

e1000是网卡核心模块的名字。

#### 确认网卡是否被载入lsmod\modinfo

```shell
lsmod | grep 1000
```

![image-20220113161738021](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220113161738021.png)

### Internet参数设置

有多种上网方式可以进行设置。

#### 网络相关配置文件

- 参数配置文件

<img src="https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220113161923962.png" alt="image-20220113161923962" style="zoom:80%;" />

- 相关命令脚本

  - `/etc/init.d/network restart`

    重启整个网络参数！读取上述配置文件，并恢复系统默认的参数

  - `ifup/ifdown eth0`

    启动或关闭某个网络接口。

#### 手动设定固定IP

![image-20220113162617115](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220113162617115.png)

- IP相关参数

  ![image-20220113162734504](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220113162734504.png)

  注意，其中`GATEWAY`是整个系统的默认网关，在有多个网卡的时候，只需要一个网卡的配置文件设置即可。

- DNS

  ![image-20220113163402840](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220113163402840.png)

  使用`dig`命令可以测试是否设置正确

  ![image-20220113163514976](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220113163514976.png)

- hostname

  ![image-20220113163652825](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220113163652825.png)

  设置完后一定要reboot（重启）。

#### 自动取得IP

利用DHCP功能，从DHCP服务器（比如IP分享器）取得IP。

![image-20220113164150770](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220113164150770.png)

文件里面的其他参数都可以用#注释掉，特别是**GATEWAY参数一定不能设置**。

### 通过无线网的连接设置

无线网络（Wireless LAN，WLAN)的机制非常多，场景的WIFI是IEEE 802.11b标准。

![image-20220113165122560](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220113165122560.png)

#### 硬件

WLAN中有两个重要的网络设备：无线基地台（Wireless Access Point，AP）和无线网卡。

AP本身就是一个IP分享器，一个对外连接Internet，一个对内接收无线网卡的数据。**常见的AP设备如TP-Link**。

AP一般需要做一些限制，来保护内部的WLAN，常见的就是连接AP时需要验证密钥。主要是两个参数：

- ESSID/SSID

  AP的名字

- 密码

  密码有2中常见的加密方式

  - WPA/WPA2
  - WPA-PSK/WPA2-PSK(一般用这个)

#### 配置文件

也在`/etc/sysconfig/network-scripts`下面

#### 查看无线网卡状态iwconfig

![](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220113165815458.png)

然后可以继续使用`modinfo`来查看加载状况。

#### 启动无线网卡

```shell
ifconfig netcardid up
```

或

```
ifup wlname
```

#### 侦测AP

```shell
iwlist netcardid scan
```

![image-20220113170427618](https://gitee.com/Object_Jason/my-pic-go/raw/master/img/image-20220113170427618.png)

利用上述得到的参数，修改配置文件，在`/etc/Wireless`目录下，比较麻烦。



# Linux网络常用指令

chapter 5

# Linux网络安全

Chapter 7 8 9

# Linux远程联机服务

chapter 11
